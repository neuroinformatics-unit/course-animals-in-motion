{
  "hash": "ebf36b185fea046096e3c6039592eb14",
  "result": {
    "engine": "jupyter",
    "markdown": "# A mouse's daily activity log {#sec-movement-mouse}\n\nIn this case study, we'll be using the [`movement` package](https://movement.neuroinformatics.dev/) to dive into mouse home cage monitoring data acquired in [Smart-Kages](https://cambridgephenotyping.com/products) and tracked with [DeepLabCut](https://www.deeplabcut.org/). We'll explore how mouse activity levels fluctuate throughout the day.\n\nBefore you get started, make sure you've set up the `animals-in-motion-env` environment (refer to [prerequisites @sec-install-movement]) and are using it to run this code. You'll also need to download the `Smart-Kages.zip` archive from [Dropbox](https://www.dropbox.com/scl/fo/81ug5hoy9msc7v7bteqa0/AH32RLdbZqWZJstIeR4YHZY?rlkey=blgagtaizw8aac5areja6h7q1&st=w1zueyi9&dl=0) (see [prerequisites @sec-data]) and unzip it.\n\n## Import libraries\n\n::: {#e4fc9cb0 .cell execution_count=2}\n``` {.python .cell-code}\nfrom pathlib import Path\n\nimport matplotlib.pyplot as plt\nimport pandas as pd\nimport numpy as np\nimport xarray as xr\nfrom matplotlib import colormaps\n\nfrom movement import sample_data\nfrom movement.filtering import filter_by_confidence, rolling_filter\nfrom movement.kinematics import compute_speed\nfrom movement.plots import plot_occupancy\nfrom movement.roi import PolygonOfInterest\nfrom movement.transforms import scale\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nDownloading data from 'https://gin.g-node.org/neuroinformatics/movement-test-data/raw/master/metadata.yaml' to file '/Users/nsirmpilatze/.movement/data/temp_metadata.yaml'.\nSHA256 hash of downloaded file: ab9c9c95a3f8366583e2cdb9c84610c62bd0bb0c6cbbcbbdc6a3390b6108623f\nUse this value as the 'known_hash' argument of 'pooch.retrieve' to ensure that the file hasn't changed if it is downloaded again in the future.\n```\n:::\n:::\n\n\n\n## The Smart-Kages dataset\n\n::: {.callout-note title=\"Acknowledgement\"}\nThis dataset was kindly shared by [Dr. Loukia Katsouri](https://www.sainsburywellcome.org/web/people/loukia-katsouri) from the [O'Keefe Lab](https://www.sainsburywellcome.org/web/groups/okeefe-lab), with permission to use for this workshop.\n:::\n\nThe Smart-Kages dataset comprises home cage recordings from two mice,\neach housed in a specialised [Smart-Kage](https://cambridgephenotyping.com/products) [@ho_fully_2023]—a home cage\nmonitoring system equipped with a camera mounted atop the cage.\n\nThe camera captures data around the clock at a rate of 2 frames per second, saving a video\nsegment for each hour of the day. A pre-trained DeepLabCut model is then used\nto predict 8 keypoints on the mouse's body.\n\nLet's examine the contents of the downloaded data.\nYou will need to specify the path to the unzipped `Smart-Kages` folder on your machine.\n\n::: {#74e60446 .cell execution_count=4}\n``` {.python .cell-code}\n# Replace with the path to the unzipped Smart-Kages folder on your machine\nsmart_kages_path = Path.home() / \".movement\" / \"Smart-Kages\"\n\n# Let's visualise the contents of the folder\nfiles = [f.name for f in smart_kages_path.iterdir()]\nfiles.sort()\nfor file in files:\n    print(file)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n.DS_Store\nkage14.nc\nkage14_background.png\nkage17.nc\nkage17_background.png\n```\n:::\n:::\n\n\nThe tracking data are stored in two`.nc` (netCDF) files: `kage14` and `kage17`.\nnetCDF is an HDF5-based file format that can be natively saved/loaded by the `xarray` library, and is therefore [convenient to use with `movement`](https://movement.neuroinformatics.dev/user_guide/input_output.html#native-saving-and-loading-with-netcdf).\n\nApart from these, we also have two `.png` files: `kage14_background.png` and `kage17_background.png`, which constitute frames extracted from the videos.\n\nLet's take a look at them.\n\n::: {#cell-fig-background-frames .cell execution_count=5}\n``` {.python .cell-code code-fold=\"true\"}\nkages = [\"kage14\", \"kage17\"]\nimg_paths = [smart_kages_path / f\"{kage}_background.png\" for kage in kages]\nimages = [plt.imread(img_path) for img_path in img_paths]\n\nfig, axes = plt.subplots(nrows=1, ncols=2, figsize=(8, 4))\n\nfor i, img in enumerate(images):\n    axes[i].imshow(img)\n    axes[i].set_title(f\"{kages[i]}\")\n    axes[i].axis(\"off\")\n```\n\n::: {.cell-output .cell-output-display}\n![Top-down camera views of the Smart-Kage habitats](05-movement-mouse_files/figure-html/fig-background-frames-output-1.png){#fig-background-frames}\n:::\n:::\n\n\n::: {.callout-tip title=\"Questions A\"}\n\n1. What objects do you see in the habitat?\n2. What challenges do you anticipate with tracking a mouse in this environment?\n3. What are the trade-offs one has to consider when designing a continuous monitoring system?\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\n1. The habitat contains several objects, including the mouse's nest, a running wheel, a climbing platform, a toilet paper roll, and a corridor with two arms near the top.\n2. The presence of these objects is likely to cause occlusions, meaning the mouse or parts of it may frequently be obscured from the camera's view.\n3. The requirements for animal welfare, such as providing a rich environment, often conflict with the needs of the tracking system. While a single black mouse on a white background would be straightforward to track, such conditions would not support the mouse's well-being over time, nor would they yield naturalistic behavior.\n:::\n\n:::\n\nLet's load and inspect the tracking data:\n\n::: {#2a43928b .cell execution_count=6}\n``` {.python .cell-code}\nds_kages = {}  # a dictionary to store kage name -> xarray dataset\n\nfor kage in [\"kage14\", \"kage17\"]:\n    ds_kages[kage] = xr.open_dataset(smart_kages_path / f\"{kage}.nc\")\n\nds_kages[\"kage14\"]   # Change to \"kage17\" to inspect the other dataset\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 1GB\nDimensions:          (time: 5236793, space: 2, keypoints: 8, individuals: 1)\nCoordinates: (5)\nData variables:\n    position         (time, space, keypoints, individuals) float64 670MB ...\n    confidence       (time, keypoints, individuals) float64 335MB ...\nAttributes: (7)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-1aaf0282-e2a3-4234-af4b-efdd365c5625' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-1aaf0282-e2a3-4234-af4b-efdd365c5625' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 5236793</li><li><span class='xr-has-index'>space</span>: 2</li><li><span class='xr-has-index'>keypoints</span>: 8</li><li><span class='xr-has-index'>individuals</span>: 1</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-162c4d99-f204-4ab9-9291-019ce28f066e' class='xr-section-summary-in' type='checkbox'  ><label for='section-162c4d99-f204-4ab9-9291-019ce28f066e' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>space</span></div><div class='xr-var-dims'>(space)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;x&#x27; &#x27;y&#x27;</div><input id='attrs-f409718e-c434-404c-845f-df4262940216' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f409718e-c434-404c-845f-df4262940216' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-48ea8601-ce5a-4198-96e7-7c407e2001d6' class='xr-var-data-in' type='checkbox'><label for='data-48ea8601-ce5a-4198-96e7-7c407e2001d6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>keypoints</span></div><div class='xr-var-dims'>(keypoints)</div><div class='xr-var-dtype'>&lt;U10</div><div class='xr-var-preview xr-preview'>&#x27;snout&#x27; &#x27;leftear&#x27; ... &#x27;tailbase&#x27;</div><input id='attrs-b5aefdec-dfb3-4c52-9ff9-374187ecef4b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b5aefdec-dfb3-4c52-9ff9-374187ecef4b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ca00c259-f050-4250-b7ef-23ccbb864c4d' class='xr-var-data-in' type='checkbox'><label for='data-ca00c259-f050-4250-b7ef-23ccbb864c4d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;snout&#x27;, &#x27;leftear&#x27;, &#x27;rightear&#x27;, &#x27;neck&#x27;, &#x27;spine1&#x27;, &#x27;bodycenter&#x27;,\n       &#x27;spine2&#x27;, &#x27;tailbase&#x27;], dtype=&#x27;&lt;U10&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>individuals</span></div><div class='xr-var-dims'>(individuals)</div><div class='xr-var-dtype'>&lt;U12</div><div class='xr-var-preview xr-preview'>&#x27;individual_0&#x27;</div><input id='attrs-34e52aaf-16c9-413e-86ac-577277300a0a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-34e52aaf-16c9-413e-86ac-577277300a0a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ab6cff79-7d45-4af7-9b82-8aa22252c05d' class='xr-var-data-in' type='checkbox'><label for='data-ab6cff79-7d45-4af7-9b82-8aa22252c05d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;individual_0&#x27;], dtype=&#x27;&lt;U12&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-08T13:55:40 ... 2024-05-...</div><input id='attrs-bc2ef93a-d775-44a1-b4ad-d84f455df09d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bc2ef93a-d775-44a1-b4ad-d84f455df09d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7383b497-bdb1-4913-8fdc-a7efdc485079' class='xr-var-data-in' type='checkbox'><label for='data-7383b497-bdb1-4913-8fdc-a7efdc485079' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-08T13:55:40.000000000&#x27;, &#x27;2024-04-08T13:55:40.499044000&#x27;,\n       &#x27;2024-04-08T13:55:40.998088000&#x27;, ..., &#x27;2024-05-10T07:59:58.501344000&#x27;,\n       &#x27;2024-05-10T07:59:59.001274000&#x27;, &#x27;2024-05-10T07:59:59.501205000&#x27;],\n      shape=(5236793,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>seconds_elapsed</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-71bda7e1-ad94-4ec6-9920-95b3859b9447' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-71bda7e1-ad94-4ec6-9920-95b3859b9447' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a5bb45ac-58bb-429c-8336-e1d964d44c42' class='xr-var-data-in' type='checkbox'><label for='data-a5bb45ac-58bb-429c-8336-e1d964d44c42' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[5236793 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-ec8c8a8e-b8e5-4ec9-b58f-124d7073af5a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-ec8c8a8e-b8e5-4ec9-b58f-124d7073af5a' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>position</span></div><div class='xr-var-dims'>(time, space, keypoints, individuals)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-f740fc8f-27b7-4e79-a7be-04b38385e8c9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f740fc8f-27b7-4e79-a7be-04b38385e8c9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9cdd94c2-4054-4883-bc88-9faa5caf29e6' class='xr-var-data-in' type='checkbox'><label for='data-9cdd94c2-4054-4883-bc88-9faa5caf29e6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[83788688 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>confidence</span></div><div class='xr-var-dims'>(time, keypoints, individuals)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-5dcec66d-4969-46be-849b-ba188e58954b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5dcec66d-4969-46be-849b-ba188e58954b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-876a32cc-4eac-41f9-ab7c-05cd0d3509cb' class='xr-var-data-in' type='checkbox'><label for='data-876a32cc-4eac-41f9-ab7c-05cd0d3509cb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[41894344 values with dtype=float64]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f1ff223e-fc84-4839-b7e7-43553bf7d6d2' class='xr-section-summary-in' type='checkbox'  ><label for='section-f1ff223e-fc84-4839-b7e7-43553bf7d6d2' class='xr-section-summary' >Indexes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>space</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-8cb14866-9e53-4924-8a9e-f68ebc130d0e' class='xr-index-data-in' type='checkbox'/><label for='index-8cb14866-9e53-4924-8a9e-f68ebc130d0e' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;object&#x27;, name=&#x27;space&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>keypoints</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-49bb31bf-722b-4f63-bbfd-594cd373802a' class='xr-index-data-in' type='checkbox'/><label for='index-49bb31bf-722b-4f63-bbfd-594cd373802a' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;snout&#x27;, &#x27;leftear&#x27;, &#x27;rightear&#x27;, &#x27;neck&#x27;, &#x27;spine1&#x27;, &#x27;bodycenter&#x27;,\n       &#x27;spine2&#x27;, &#x27;tailbase&#x27;],\n      dtype=&#x27;object&#x27;, name=&#x27;keypoints&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>individuals</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-2334cf34-5251-480a-880c-fe67e4536c40' class='xr-index-data-in' type='checkbox'/><label for='index-2334cf34-5251-480a-880c-fe67e4536c40' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;individual_0&#x27;], dtype=&#x27;object&#x27;, name=&#x27;individuals&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-d8284f74-f1cb-46c2-8242-8f51e8f4f73b' class='xr-index-data-in' type='checkbox'/><label for='index-d8284f74-f1cb-46c2-8242-8f51e8f4f73b' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([       &#x27;2024-04-08 13:55:40&#x27;, &#x27;2024-04-08 13:55:40.499044&#x27;,\n               &#x27;2024-04-08 13:55:40.998088&#x27;, &#x27;2024-04-08 13:55:41.497133&#x27;,\n               &#x27;2024-04-08 13:55:41.996177&#x27;, &#x27;2024-04-08 13:55:42.495221&#x27;,\n               &#x27;2024-04-08 13:55:42.994266&#x27;, &#x27;2024-04-08 13:55:43.493310&#x27;,\n               &#x27;2024-04-08 13:55:43.992354&#x27;, &#x27;2024-04-08 13:55:44.491399&#x27;,\n               ...\n               &#x27;2024-05-10 07:59:55.001829&#x27;, &#x27;2024-05-10 07:59:55.501760&#x27;,\n               &#x27;2024-05-10 07:59:56.001691&#x27;, &#x27;2024-05-10 07:59:56.501621&#x27;,\n               &#x27;2024-05-10 07:59:57.001552&#x27;, &#x27;2024-05-10 07:59:57.501482&#x27;,\n               &#x27;2024-05-10 07:59:58.001413&#x27;, &#x27;2024-05-10 07:59:58.501344&#x27;,\n               &#x27;2024-05-10 07:59:59.001274&#x27;, &#x27;2024-05-10 07:59:59.501205&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=5236793, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-82dcc298-808f-4d39-a713-bd5c1f1d538c' class='xr-section-summary-in' type='checkbox'  ><label for='section-82dcc298-808f-4d39-a713-bd5c1f1d538c' class='xr-section-summary' >Attributes: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>source_software :</span></dt><dd>DeepLabCut</dd><dt><span>ds_type :</span></dt><dd>poses</dd><dt><span>fps :</span></dt><dd>2.0</dd><dt><span>time_unit :</span></dt><dd>datetime64[ns]</dd><dt><span>source_file :</span></dt><dd>/Users/nsirmpilatze/Data/Smart-Kages/kage14/analysis/dlc_output/2024/04/08/kage14_20240408_135536DLC_resnet101_v2Jan17shuffle2_580000.h5</dd><dt><span>kage :</span></dt><dd>kage14</dd><dt><span>kage_start_datetime :</span></dt><dd>2024-04-08T13:55:40</dd></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nWe see that each dataset contains a huge amount of data, but the two datasets are\nnot exactly aligned in time.\n\n::: {#ae5dd427 .cell execution_count=7}\n``` {.python .cell-code code-fold=\"true\"}\nstart_times = {\n    name: pd.Timestamp(ds.time.isel(time=0).values)\n    for name, ds in ds_kages.items()\n}\nend_times = {\n    name: pd.Timestamp(ds.time.isel(time=-1).values)\n    for name, ds in ds_kages.items()\n}\n\nfor name in start_times.keys():\n    print(f\"{name}: from {start_times[name]} to {end_times[name]}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nkage14: from 2024-04-08 13:55:40 to 2024-05-10 07:59:59.501205\nkage17: from 2024-04-03 00:00:06 to 2024-05-10 07:59:59.509103\n```\n:::\n:::\n\n\n## Datetime Coordinates\n\nYou might notice something interesting about the time coordinates in these `xarray` datasets: they're given in `datetime64[ns]` format, which means they're precise timestamps expressed in \"calendar time\".\n\nThis is different from what we've seen before in other `movement` datasets, where time coordinates are expressed as seconds elapsed since the start of the video, or \"elapsed time\".\n\n::: {.callout-note title=\"How did we get these timestamps?\" collapse=\"true\"}\n\nSome recording systems can output timestamps for each video frame. In our case, the raw data from the Smart-Kage system included the start datetime of each 1-hour-long video segment and the precise time difference between the start of each segment and every frame within it.\n\nUsing this information, we were able to reconstruct precise datetime coordinates for all frames throughout the entire experiment. We then concatenated the DeepLabCut predictions from all video segments and assigned the datetime coordinates to the resulting dataset. If you're interested in the details, you can find the code in the [smart-kages-movement GitHub repository](https://github.com/neuroinformatics-unit/smart-kages-movement).\n\n:::\n\nUsing \"calendar time\" is convenient for many applications.\nFor example, we could cross-reference the tracking results against other data sources, such as body weight measurements.\n\nIt also allows us to easily select time windows by datetime.\nWe will leverage this here to select a time window that's common to both kages.\nNote that we discard the last few days because the experimenter introduced\nsome interventions during that time, which are out of scope for this case study.\n\n::: {#436f44b3 .cell execution_count=8}\n``` {.python .cell-code}\ncommon_start = \"2024-04-09 00:00:00\"\ncommon_end = \"2024-05-07 00:00:00\"\n\nfor kage in [\"kage14\", \"kage17\"]:\n    ds_kages[kage] = ds_kages[kage].sel(time=slice(common_start, common_end))\n```\n:::\n\n\nBeyond this ability to select time windows by date and time,\nwe will see many other benefits of using datetime coordinates in the rest of this case study.\n\nThat said, it's still useful to also know the total time elapsed since the start of the experiment.\nIn fact, many `movement` functions will expect \"elapsed time\" and may not work with datetime coordinates (for now).\n\nLuckily, it's easy to convert datetime coordinates to \"elapsed time\" by simply subtracting the start datetime of the whole experiment from each timestamp.\n\n::: {#3c155313 .cell execution_count=9}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Expand to see how this can be done\"}\nds_14 = ds_kages[\"kage14\"]\n\n# Get the start datetime the experiment in kage14\nexperiment_start = ds_14.time.isel(time=0).data\n\n# Subtract the start datetime from each timestamp\ntime_elapsed = (ds_14.time.data - np.datetime64(experiment_start))\n\n# Convert to seconds\nseconds_elapsed = time_elapsed / pd.Timedelta(\"1s\")\n\n# Assign the seconds_elapsed coordinate to the \"time\" dimension\nds_14 = ds_14.assign_coords(seconds_elapsed=(\"time\", seconds_elapsed))\n```\n:::\n\n\nWe've pre-computed this for convenience and stored it in a secondary time coordinate called `seconds_elapsed`.\n\n::: {#aad07d6d .cell execution_count=10}\n``` {.python .cell-code}\nprint(ds_14.coords[\"time\"].values[:2])\nprint(ds_14.coords[\"seconds_elapsed\"].values[:2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['2024-04-09T00:00:06.000000000' '2024-04-09T00:00:06.500000000']\n[0.  0.5]\n```\n:::\n:::\n\n\nWhenever we want to switch to \"elapsed time\" mode, we can simply set the `seconds_elapsed` coordinates as the \"index\" of the `time` dimension. This means that `seconds_elapsed` will be used as the primary time coordinate, allowing us to select data by it.\n\n::: {#3a38e13b .cell execution_count=11}\n``` {.python .cell-code}\nds_14.set_index(time=\"seconds_elapsed\").sel(time=slice(0, 1800))\n```\n:::\n\n\n::: {.callout-tip title=\"Exercise A\"}\n\nFor each of the two kages:\n\n1. Plot the x-axis position of the mouse's body center over time, for the week starting on April 15th. What do you notice?\n2. Plot the median confidence of the body center for each day, over the entire duration of the experiment.\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\n::: {#543047eb .cell execution_count=12}\n``` {.python .cell-code}\nfig, axes = plt.subplots(nrows=2, ncols=1, figsize=(8, 5), sharex=True)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    ds = ds_kages[kage].squeeze()  # remove redundant \"individuals\" dimension\n    body_center = ds.position.sel(\n        keypoints=\"bodycenter\",\n        time=slice(\"2024-04-15 00:00:00\", \"2024-04-21 23:59:59\"),\n        space=\"x\"\n    )\n    body_center.plot.line(ax=axes[i])\n    axes[i].set_title(f\"{kage} body center x\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](05-movement-mouse_files/figure-html/cell-12-output-1.png){}\n:::\n:::\n\n\n::: {#fec901d5 .cell execution_count=13}\n``` {.python .cell-code}\nfig, axes = plt.subplots(nrows=2, ncols=1, figsize=(8, 5), sharex=True)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    ds = ds_kages[kage].squeeze()\n    ds_daily = ds.resample(time=\"1D\").median()\n    ds_daily.confidence.sel(keypoints=\"bodycenter\").plot.line(ax=axes[i])\n    axes[i].set_title(f\"{kage} body center\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](05-movement-mouse_files/figure-html/cell-13-output-1.png){}\n:::\n:::\n\n\n:::\n\n:::\n\n## Cleaning the data\n\nLet's examine the range of confidence values for each keypoint.\n\n::: {#cell-fig-confidence-range .cell execution_count=14}\n``` {.python .cell-code code-fold=\"true\"}\nkage = \"kage14\"\nconfidence = ds_kages[kage].confidence.squeeze()\n\nfig, ax = plt.subplots(figsize=(8, 3))\nconfidence.quantile(q=0.25, dim=\"time\").plot.line(\"o--\", color=\"gray\", ax=ax, label=\"25% quantile\")\nconfidence.quantile(q=0.75, dim=\"time\").plot.line(\"o--\", color=\"gray\", ax=ax, label=\"75% quantile\")\nconfidence.median(dim=\"time\").plot.line(\"o-\", color=\"black\", ax=ax, label=\"median\")\n\nax.legend()\nax.set_title(f\"{kage} confidence range\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Confidence range by keypoint](05-movement-mouse_files/figure-html/fig-confidence-range-output-1.png){#fig-confidence-range}\n:::\n:::\n\n\nIt looks like the \"neck\", \"bodycenter\", \"spine1\", and \"spine2\" keypoints\nare the most confidently detected.\nLet us define a list of \"reliable\" keypoints for later use.\nThese are all on the mouse's body.\n\n::: {#c7013b17 .cell execution_count=15}\n``` {.python .cell-code}\nreliable_keypoints = [\"neck\", \"bodycenter\", \"spine1\", \"spine2\"]\n```\n:::\n\n\nWe can filter out low-confidence predictions.\n\n::: {#3771011f .cell execution_count=16}\n``` {.python .cell-code}\nconfidence_threshold = 0.95\n\nfor kage, ds in ds_kages.items():\n    ds[\"position_filtered\"] = filter_by_confidence(\n        ds.position,\n        ds.confidence,\n        threshold=confidence_threshold,\n    )\n```\n:::\n\n\n::: {.callout-tip title=\"Exercise B\"}\n\nLet's smooth the data with a rolling median filter.\n\n**Hint**: Remember doing this in @sec-movement-intro ?\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\n::: {#6455924d .cell execution_count=17}\n``` {.python .cell-code}\nwindow_size = 3  # frames\n\nfor kage, ds in ds_kages.items():\n    ds[\"position_smoothed\"] = rolling_filter(\n        ds.position_filtered,\n        window_size,\n        statistic=\"median\",\n    )\n```\n:::\n\n\n:::\n\n:::\n\n## Plot the mouse's speed over time\n\nLet's define a single-point representation of the mouse's position, which we'll call the `body_centroid`.\nWe derive this by taking the mean of the 4 reliable keypoints, using their smoothed positions.\n\n::: {#0f0b8386 .cell execution_count=18}\n``` {.python .cell-code}\nfor kage, ds in ds_kages.items():\n    ds[\"body_centroid\"] = ds.position_filtered.sel(\n        individuals=\"individual_0\",  # the only individual in the dataset\n        keypoints=reliable_keypoints\n    ).mean(dim=\"keypoints\")\n```\n:::\n\n\nNext, we'll compute the body centroid's speed in cm/sec via the following steps:\n\n1. Convert the body centroid position data to cm units using [`scale()`](https://movement.neuroinformatics.dev/api/movement.transforms.scale.html).\n2. Temporarily switch to \"elapsed time\" mode, because [`compute_speed()`](https://movement.neuroinformatics.dev/api/movement.kinematics.compute_speed.html) does not (yet) support datetime coordinates.\n3. Compute the speed in cm/sec\n4. Restore the original datetime coordinates to the speed data.\n\n::: {#64720194 .cell execution_count=19}\n``` {.python .cell-code}\nPIXELS_PER_CM = 10\n\nfor kage, ds in ds_kages.items():\n    # Scale from pixels to cm using a known conversion factor\n    body_centroid_cm = scale(\n        ds.body_centroid, factor=1 / PIXELS_PER_CM, space_unit=\"cm\"\n    )\n\n    # Compute the speed in cm/sec\n    ds[\"body_centroid_speed\"] = compute_speed(\n       body_centroid_cm.set_index(time=\"seconds_elapsed\")  # switch time coords\n    ).assign_coords(time=body_centroid_cm.time)            # restore datetime\n\nds_kages[\"kage14\"].body_centroid_speed\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;body_centroid_speed&#x27; (time: 4600675)&gt; Size: 37MB\nnan nan 0.05137 0.001921 0.02156 ... 0.01652 0.0186 0.02228 0.01102 0.03168\nCoordinates: (2)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'body_centroid_speed'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 4600675</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-fdaf578a-54b9-49c9-854e-d115c492977b' class='xr-array-in' type='checkbox' ><label for='section-fdaf578a-54b9-49c9-854e-d115c492977b' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan 0.05137 0.001921 0.02156 ... 0.0186 0.02228 0.01102 0.03168</span></div><div class='xr-array-data'><pre>array([       nan,        nan, 0.05137345, ..., 0.02227513, 0.01102056,\n       0.03167816], shape=(4600675,))</pre></div></div></li><li class='xr-section-item'><input id='section-1def59d8-ab82-4fc0-a9a8-d68b5764c6a4' class='xr-section-summary-in' type='checkbox'  ><label for='section-1def59d8-ab82-4fc0-a9a8-d68b5764c6a4' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-09T00:00:06 ... 2024-05-...</div><input id='attrs-631acfaa-e019-467a-a3ff-4a66ea1028c3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-631acfaa-e019-467a-a3ff-4a66ea1028c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-51c6676c-076b-4778-9e4e-b30d008ab272' class='xr-var-data-in' type='checkbox'><label for='data-51c6676c-076b-4778-9e4e-b30d008ab272' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-09T00:00:06.000000000&#x27;, &#x27;2024-04-09T00:00:06.500000000&#x27;,\n       &#x27;2024-04-09T00:00:07.000000000&#x27;, ..., &#x27;2024-05-06T23:59:58.497744000&#x27;,\n       &#x27;2024-05-06T23:59:58.997674000&#x27;, &#x27;2024-05-06T23:59:59.497604000&#x27;],\n      shape=(4600675,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>seconds_elapsed</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.627e+04 3.627e+04 ... 2.455e+06</div><input id='attrs-ca016f8a-02ba-4660-97fe-116add93531f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ca016f8a-02ba-4660-97fe-116add93531f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-498addf1-0bc9-464d-bdac-2a29c676bedf' class='xr-var-data-in' type='checkbox'><label for='data-498addf1-0bc9-464d-bdac-2a29c676bedf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  36266.      ,   36266.5     ,   36267.      , ..., 2455458.497744,\n       2455458.997674, 2455459.497604], shape=(4600675,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b4b2680a-0afe-48e1-9a28-e0b23c927f89' class='xr-section-summary-in' type='checkbox'  ><label for='section-b4b2680a-0afe-48e1-9a28-e0b23c927f89' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-88010d83-068d-4472-aeb9-9b0d4673f104' class='xr-index-data-in' type='checkbox'/><label for='index-88010d83-068d-4472-aeb9-9b0d4673f104' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([       &#x27;2024-04-09 00:00:06&#x27;, &#x27;2024-04-09 00:00:06.500000&#x27;,\n                      &#x27;2024-04-09 00:00:07&#x27;, &#x27;2024-04-09 00:00:07.500000&#x27;,\n                      &#x27;2024-04-09 00:00:08&#x27;, &#x27;2024-04-09 00:00:08.500000&#x27;,\n                      &#x27;2024-04-09 00:00:09&#x27;, &#x27;2024-04-09 00:00:09.500000&#x27;,\n                      &#x27;2024-04-09 00:00:10&#x27;, &#x27;2024-04-09 00:00:10.500000&#x27;,\n               ...\n               &#x27;2024-05-06 23:59:54.998233&#x27;, &#x27;2024-05-06 23:59:55.498164&#x27;,\n               &#x27;2024-05-06 23:59:55.998094&#x27;, &#x27;2024-05-06 23:59:56.498024&#x27;,\n               &#x27;2024-05-06 23:59:56.997954&#x27;, &#x27;2024-05-06 23:59:57.497884&#x27;,\n               &#x27;2024-05-06 23:59:57.997814&#x27;, &#x27;2024-05-06 23:59:58.497744&#x27;,\n               &#x27;2024-05-06 23:59:58.997674&#x27;, &#x27;2024-05-06 23:59:59.497604&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=4600675, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-545ecc97-fbba-4da4-b113-355cd47766b8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-545ecc97-fbba-4da4-b113-355cd47766b8' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nLet's plot the speed over time.\n\n::: {#cell-fig-body-speed .cell execution_count=20}\n``` {.python .cell-code}\nfig, axes = plt.subplots(\n    nrows=2, ncols=1, figsize=(8, 5), sharex=True, sharey=True\n)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    ds_kages[kage].body_centroid_speed.plot.line(ax=axes[i])\n    axes[i].set_title(f\"{kage} body centroid\")\n    axes[i].set_ylabel(\"speed (cm/sec)\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Body centroid speed](05-movement-mouse_files/figure-html/fig-body-speed-output-1.png){#fig-body-speed}\n:::\n:::\n\n\n::: {.callout-tip title=\"Questions B\"}\n\n1. What are potential sources of error in the speed calculation?\n2. What do you notice about the overall speed fluctuations over time? What do you think is the reason for this?\n3. Do you notice any differences between the two kages? Feel free to \"zoom in\" on specific time windows to investigate this.\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\n**Potential sources of error in speed calculation:** The accuracy of speed computation is heavily reliant on precise position data. Any inaccuracies in predicting keypoint positions (i.e., the discrepancy between actual and estimated positions) can be exacerbated when calculating speed, as it is derived from the differences between consecutive positions. Additionally, we have assumed a fixed conversion factor of 10 pixels per cm. While this value may be accurate for the habitat's floor, the environment is not entirely flat. It includes objects for climbing, which means the conversion factor will vary depending on the mouse's vertical position (distance from the camera).\n\nThe speed seems to fluctuate in a circadian pattern, especially apparent in kage14.\nThis will become clearer if we zoom in on a time window of a few days.\n\n::: {#e4c5b2d3 .cell execution_count=21}\n``` {.python .cell-code code-fold=\"true\"}\ntime_window = slice(\"2024-04-22\", \"2024-04-26\")\n\nfig, axes = plt.subplots(\n    nrows=2, ncols=1, figsize=(7.5, 5), sharex=True, sharey=True\n)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    speed = ds_kages[kage].body_centroid_speed.sel(time=time_window)\n    speed.plot.line(ax=axes[i])\n    axes[i].set_title(f\"{kage} body centroid\")\n    axes[i].set_ylabel(\"speed (pixels/sec)\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](05-movement-mouse_files/figure-html/cell-21-output-1.png){}\n:::\n:::\n\n\nWe also note that the circadian pattern is more pronounced in kage14,\nand seems to be somewhat disrupted in kage17. The mouse in kage17\nseems to be more active overall, both during the day and at night.\n:::\n\n:::\n\n::: {.callout-note title=\"A side-note on 3D pose estimation\" collapse=\"true\"}\n\nWith only a single top-down view of the mouse, we are limited to 2D pose estimation.\nThis means the estimated keypoint coordinates are simply projections of the true 3D coordinates onto the 2D image plane.\n\nThis is the most common approach to pose estimation, but it cannot accurately measure true dimensions.\nAny conversion from pixels to physical units (e.g. centimetres) will be imprecise, and sometimes significantly so.\n\nThis limitation can be overcome by using multiple cameras from different viewpoints and performing 3D pose estimation.\nThere are two main markerless approaches:\n\n1. The first approach is to do 'regular' 2D pose estimation in each camera view,\n   then triangulate across camera views to estimate 3D pose. The triangulation\n   relies on known parameters about the cameras and their relative positions\n   and orientations. [Anipose](https://anipose.readthedocs.io/en/latest/)\n   [@karashchuk_anipose_2021] is a popular open-source toolkit that\n   implements this approach.\n\n   ![Source: @pereira_quantifying_2020](img/pose_estimation_3D.png)\n\n2. The second approach, implemented in [DANNCE](https://github.com/spoonsso/dannce)\n   [@dunn_geometric_2021], is to use a fully 3D convolutional neural network (CNN) that\n   can learn about 3D image features and how cameras and landmarks\n   relate to one another in 3D space.\n\n   ![Source: <https://github.com/spoonsso/dannce>](img/DANNCE.png)\n\nSome **prompts for discussion**:\n\n- What are the pros and cons of 2D vs 3D markerless pose estimation?\n- In which scenarios would you prefer one over the other?\n\n:::\n\n## Plot actograms {#sec-actograms}\n\nAn actogram is a visualisation of the mouse's activity level over time.\n\nAs a measure of activity we'll use the cumulative distance traversed\nby the mouse's body centroid in a given time bin—in this case, 10 minutes.\nSince we have already computed the speed (cm/sec), we can multiply that by the time bin duration in seconds to get the distance (cm).\n\n::: {#abaa15bd .cell execution_count=22}\n``` {.python .cell-code}\nfor kage in [\"kage14\", \"kage17\"]:\n    time_diff = ds_kages[kage].coords[\"seconds_elapsed\"].diff(dim=\"time\")\n    ds_kages[kage][\"distance\"] = ds_kages[kage].body_centroid_speed * time_diff\n```\n:::\n\n\nThen we can sum the distance traversed in each time bin to get the activity level.\n\n::: {#cell-fig-activity-levels .cell execution_count=23}\n``` {.python .cell-code}\ntime_bin_minutes = 10\ntime_bin_duration = pd.Timedelta(f\"{time_bin_minutes}min\")\n\nfig, ax = plt.subplots(\n    nrows=2, ncols=1, figsize=(8, 5), sharex=True, sharey=True\n)\n\nactivity_dict = {}  # Dictionary to store the activity levels for each kage\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    activity = ds_kages[kage].distance.resample(time=time_bin_duration).sum()\n    activity.plot.line(ax=ax[i])\n    ax[i].set_title(f\"{kage} activity\")\n    ax[i].set_ylabel(\"distance (cm)\")\n    ax[i].set_xlabel(\"time\")\n\n    activity_dict[kage] = activity\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Activity over time](05-movement-mouse_files/figure-html/fig-activity-levels-output-1.png){#fig-activity-levels}\n:::\n:::\n\n\nTo make any circadian patterns more apparent, we will stack days vertically\nand indicate the light cycle with gray areas.\nFor this particular experiment, the light cycle is as follows:\n\n- lights off at 9:30\n- dawn at 20:30\n- lights on at 21:30\n\n::: {#6b90d737 .cell execution_count=24}\n``` {.python .cell-code}\n# Define light cycle (in minutes since midnight)\nlights_off = 9 * 60 + 30  # 9:30 AM in minutes\ndawn = 20 * 60 + 30       # 8:30 PM in minutes  \nlights_on = 21 * 60 + 30  # 9:30 PM in minutes\n\nn_bins_in_day = int(24 * 60 / time_bin_minutes)\n\nactogram_dict = {}  # Dictionary to store the 2D actogram for each kage\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    activity = activity_dict[kage]\n    days = list(activity.groupby(\"time.date\").groups.keys())\n\n    # Create an empty 2D actogram with dims (date, time_bin)\n    actogram = xr.DataArray(\n        np.zeros((len(days), n_bins_in_day)),\n        dims=[\"date\", \"time_of_day\"],\n        coords={\n            \"date\": days,\n            \"time_of_day\": np.arange(\n                time_bin_minutes/2, 24 * 60, time_bin_minutes\n            )\n        },\n    )\n    # Populate 2D actogram per day\n    for date, day_activity in activity.groupby(\"time.date\"):\n        actogram.loc[dict(date=date)] = day_activity.values\n\n    # Store the actogram in the dictionary for later use\n    actogram_dict[kage] = actogram\n\nactogram_dict[\"kage14\"]  # Replace with kage17 to see the actogram for kage17\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (date: 28, time_of_day: 144)&gt; Size: 32kB\n21.94 12.34 15.7 40.82 51.96 359.7 337.1 ... 59.47 65.09 69.83 41.08 50.58 95.62\nCoordinates: (2)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>date</span>: 28</li><li><span class='xr-has-index'>time_of_day</span>: 144</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-1eefb8ff-2ec2-4899-82c9-b03a33f60c73' class='xr-array-in' type='checkbox' ><label for='section-1eefb8ff-2ec2-4899-82c9-b03a33f60c73' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>21.94 12.34 15.7 40.82 51.96 359.7 ... 65.09 69.83 41.08 50.58 95.62</span></div><div class='xr-array-data'><pre>array([[ 21.94353274,  12.3359559 ,  15.69606955, ..., 370.01643336,\n        148.41509776,  43.63468815],\n       [ 24.34439421,  28.70382676,  35.21278474, ...,  37.0943919 ,\n         32.72694742, 170.30008811],\n       [165.96110319,  22.25839305,  22.3546828 , ...,  13.99343428,\n         10.45916989,  17.76600485],\n       ...,\n       [ 17.13844639,  19.77411278,  42.93937937, ...,  10.3900106 ,\n         21.68248825, 166.8786525 ],\n       [268.03459651,  65.77269862,  72.07467688, ..., 211.74754295,\n         71.80358134,  57.01412942],\n       [ 50.11294109,  30.36584632,  91.0799254 , ...,  41.08254947,\n         50.5819582 ,  95.6220443 ]], shape=(28, 144))</pre></div></div></li><li class='xr-section-item'><input id='section-010388d7-bd6e-459a-80f9-70d249992f6a' class='xr-section-summary-in' type='checkbox'  ><label for='section-010388d7-bd6e-459a-80f9-70d249992f6a' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>date</span></div><div class='xr-var-dims'>(date)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>2024-04-09 ... 2024-05-06</div><input id='attrs-e0c91724-46f5-43ec-b61e-a6428b1d6f79' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e0c91724-46f5-43ec-b61e-a6428b1d6f79' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-154a8595-3ed1-4842-8028-daf90ab479af' class='xr-var-data-in' type='checkbox'><label for='data-154a8595-3ed1-4842-8028-daf90ab479af' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([datetime.date(2024, 4, 9), datetime.date(2024, 4, 10),\n       datetime.date(2024, 4, 11), datetime.date(2024, 4, 12),\n       datetime.date(2024, 4, 13), datetime.date(2024, 4, 14),\n       datetime.date(2024, 4, 15), datetime.date(2024, 4, 16),\n       datetime.date(2024, 4, 17), datetime.date(2024, 4, 18),\n       datetime.date(2024, 4, 19), datetime.date(2024, 4, 20),\n       datetime.date(2024, 4, 21), datetime.date(2024, 4, 22),\n       datetime.date(2024, 4, 23), datetime.date(2024, 4, 24),\n       datetime.date(2024, 4, 25), datetime.date(2024, 4, 26),\n       datetime.date(2024, 4, 27), datetime.date(2024, 4, 28),\n       datetime.date(2024, 4, 29), datetime.date(2024, 4, 30),\n       datetime.date(2024, 5, 1), datetime.date(2024, 5, 2),\n       datetime.date(2024, 5, 3), datetime.date(2024, 5, 4),\n       datetime.date(2024, 5, 5), datetime.date(2024, 5, 6)], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time_of_day</span></div><div class='xr-var-dims'>(time_of_day)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.0 15.0 ... 1.425e+03 1.435e+03</div><input id='attrs-0c45f459-de08-4d66-9319-c7c9c5dfa3e9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0c45f459-de08-4d66-9319-c7c9c5dfa3e9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0e25fe58-468b-4de6-9738-f3f691e84fb2' class='xr-var-data-in' type='checkbox'><label for='data-0e25fe58-468b-4de6-9738-f3f691e84fb2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([   5.,   15.,   25.,   35.,   45.,   55.,   65.,   75.,   85.,   95.,\n        105.,  115.,  125.,  135.,  145.,  155.,  165.,  175.,  185.,  195.,\n        205.,  215.,  225.,  235.,  245.,  255.,  265.,  275.,  285.,  295.,\n        305.,  315.,  325.,  335.,  345.,  355.,  365.,  375.,  385.,  395.,\n        405.,  415.,  425.,  435.,  445.,  455.,  465.,  475.,  485.,  495.,\n        505.,  515.,  525.,  535.,  545.,  555.,  565.,  575.,  585.,  595.,\n        605.,  615.,  625.,  635.,  645.,  655.,  665.,  675.,  685.,  695.,\n        705.,  715.,  725.,  735.,  745.,  755.,  765.,  775.,  785.,  795.,\n        805.,  815.,  825.,  835.,  845.,  855.,  865.,  875.,  885.,  895.,\n        905.,  915.,  925.,  935.,  945.,  955.,  965.,  975.,  985.,  995.,\n       1005., 1015., 1025., 1035., 1045., 1055., 1065., 1075., 1085., 1095.,\n       1105., 1115., 1125., 1135., 1145., 1155., 1165., 1175., 1185., 1195.,\n       1205., 1215., 1225., 1235., 1245., 1255., 1265., 1275., 1285., 1295.,\n       1305., 1315., 1325., 1335., 1345., 1355., 1365., 1375., 1385., 1395.,\n       1405., 1415., 1425., 1435.])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a0850165-d35e-4a41-b621-52c78a371efc' class='xr-section-summary-in' type='checkbox'  ><label for='section-a0850165-d35e-4a41-b621-52c78a371efc' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>date</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ec1808d4-2792-4aa8-9cfe-ba6326d372f4' class='xr-index-data-in' type='checkbox'/><label for='index-ec1808d4-2792-4aa8-9cfe-ba6326d372f4' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([2024-04-09, 2024-04-10, 2024-04-11, 2024-04-12, 2024-04-13, 2024-04-14,\n       2024-04-15, 2024-04-16, 2024-04-17, 2024-04-18, 2024-04-19, 2024-04-20,\n       2024-04-21, 2024-04-22, 2024-04-23, 2024-04-24, 2024-04-25, 2024-04-26,\n       2024-04-27, 2024-04-28, 2024-04-29, 2024-04-30, 2024-05-01, 2024-05-02,\n       2024-05-03, 2024-05-04, 2024-05-05, 2024-05-06],\n      dtype=&#x27;object&#x27;, name=&#x27;date&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time_of_day</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-d59884c5-f960-4f79-9f6f-acecbf2ad8ef' class='xr-index-data-in' type='checkbox'/><label for='index-d59884c5-f960-4f79-9f6f-acecbf2ad8ef' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   5.0,   15.0,   25.0,   35.0,   45.0,   55.0,   65.0,   75.0,   85.0,\n         95.0,\n       ...\n       1345.0, 1355.0, 1365.0, 1375.0, 1385.0, 1395.0, 1405.0, 1415.0, 1425.0,\n       1435.0],\n      dtype=&#x27;float64&#x27;, name=&#x27;time_of_day&#x27;, length=144))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-89709817-e410-499c-97d5-c34c252ea539' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-89709817-e410-499c-97d5-c34c252ea539' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nLet's now visualise the actograms, with the light cycle marked.\n\n::: {#cell-fig-actograms .cell execution_count=25}\n``` {.python .cell-code code-fold=\"true\"}\nmax_activity = max(\n    actogram_dict[kage].max().values for kage in [\"kage14\", \"kage17\"]\n)\n\nfig, axes = plt.subplots(\n    nrows=2, ncols=1, figsize=(8, 8), sharex=True, sharey=True,\n)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    actogram = actogram_dict[kage]\n\n    # Create a colormap for the actogram\n    cmap = colormaps.get_cmap(\"Greys\")\n    cmap.set_bad(color=\"brown\", alpha=0.5)  # Set bad values to red\n\n    # Plot the actogram\n    ax = axes[i]\n    actogram.plot(\n        ax=ax, yincrease=False, vmin=0, vmax=max_activity, cmap=cmap\n    )\n\n    # Assign x-tick labels every 4 hours formatted as HH:MM\n    ax.set_xticks(np.arange(0, 24 * 60 + 1, 4 * 60))\n    ax.set_xticklabels([f\"{i:02d}:00\" for i in np.arange(0, 25, 4)])\n\n    # Mark light cycle\n    ax.axvline(lights_off, color=\"red\", alpha=0.7, lw=2, linestyle=\"-\", label=\"lights off\")\n    ax.axvline(dawn, color=\"blue\", alpha=0.7, lw=2, linestyle=\"--\", label=\"dawn\")\n    ax.axvline(lights_on, color=\"blue\", alpha=0.7, lw=2, linestyle=\"-\", label=\"lights on\")\n    ax.legend(loc=\"lower left\")\n\n    # Set title and axis labels\n    ax.set_title(f\"{kage} actogram\")\n    ax.set_xlabel(\"Time of day\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Actograms](05-movement-mouse_files/figure-html/fig-actograms-output-1.png){#fig-actograms}\n:::\n:::\n\n\n::: {.callout-tip title=\"Exercise C\"}\n\n1. How would you describe the observed differences between the two mice?\n2. Compute the mean activity profile (across days) for each mouse.\n3. Plot the mean activity profile for each mouse, with the light cycle marked.\n\n**Hint**: Start with the `actogram_dict` dictionary and also make use of the `lights_off`  and `lights_on` variables defined above.\n\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\nThe mouse in kage17 shows higher overall activity levels, stays constantly\nactive during dark periods and also exhibits many activity bursts during the day\n(at least more than kage14 does).\n\n::: {#cell-fig-mean-activity-profiles .cell execution_count=26}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(8, 4))\n\n# Mark light cycle\nax.axvspan(lights_off, lights_on, color=\"0.8\", label=\"Dark period\")\n\nfor kage, actogram in actogram_dict.items():    \n    actogram.mean(dim=\"date\").plot.line(ax=ax, label=kage, lw=3)\n\nax.set_title(f\"Mean daily activity profile\")\nax.set_ylabel(f\"Activity\")\nax.set_xlabel(\"Time of day\")\n\n# Assign x-tick labels every 4 hours formatted as HH:MM\nax.set_xticks(np.arange(0, 24 * 60 + 1, 4 * 60))\nax.set_xticklabels([f\"{i:02d}:00\" for i in np.arange(0, 25, 4)])\n\nax.legend()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Mean daily activity profiles](05-movement-mouse_files/figure-html/fig-mean-activity-profiles-output-1.png){#fig-mean-activity-profiles}\n:::\n:::\n\n\n:::\n\n:::\n\n::: {.callout-note title=\"What underlies the differences in activity?\" collapse=\"true\"}\n\nThe mouse in `kage17` is a genetically modified model of Down Syndrome.\nThe syndrome, also known as trisomy 21, is caused in humans by the presence of all or part of a third copy of chromosome 21.\nThe mouse in `kage17` is genetically modified with a triplication of mouse chromosome 16,\nwhich carries about 150 genes homologues to the human chromosome 21.\n\nLoukia is currently investigating why this particular mouse model\nexhibits a \"restless\" behavioural phenotype.\n\n:::\n\n## Space occupancy\n\nApart from quantifying how active the mice were over time, we might also\nbe interested in which parts of the habitat they tend to frequent.\n\n`movement` provides a [`plot_occupancy()`](https://movement.neuroinformatics.dev/api/movement.plots.plot_occupancy.html) function to help us visualise the space occupancy.\n\n::: {#cell-fig-occupancy1 .cell execution_count=27}\n``` {.python .cell-code}\nfig, axes = plt.subplots(\n    nrows=1, ncols=2, figsize=(8, 4), sharex=True, sharey=True\n)\n\nplt.suptitle(\"Body centroid occupancy (log scale)\")\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    img = images[i]\n    height, width = img.shape[:2]\n\n    axes[i].imshow(img)\n    plot_occupancy(\n        # Setting the time coordinates to \"elapsed time\" is necessary\n        # for the log scale to work properly.\n        ds_kages[kage].body_centroid.set_index(time=\"seconds_elapsed\"),\n        ax=axes[i],\n        cmap=\"turbo\",\n        norm=\"log\",  # log scale the colormap\n        vmax=10**6,\n        alpha=0.6,   # some transparency\n    )\n    # Make axes match the image dimensions\n    axes[i].set_ylim([height - 1, 0])\n    axes[i].set_xlim([0, width])\n    axes[i].set_title(kage)\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Occupancy heatmaps](05-movement-mouse_files/figure-html/fig-occupancy1-output-1.png){#fig-occupancy1}\n:::\n:::\n\n\nWe see some clear hotspots, such as the nest and climbing platform.\nBut not all hotspots are created equal.\nFor example, the nest should be occupied when the mouse is stationary but\nnot when it is moving.\n\nTo investigate this, let's choose an arbitrary speed limit of 4 cm/sec, below which we consider the mouse to be stationary.\n\n::: {#cell-fig-speed-histogram .cell execution_count=28}\n``` {.python .cell-code code-fold=\"true\"}\nfig, ax = plt.subplots(figsize=(8, 4))\n\nspeed_threshold = 4\n\nfor kage in [\"kage14\", \"kage17\"]:\n    ds_kages[kage].body_centroid_speed.plot.hist(\n        ax=ax, bins=50, alpha=0.5, label=kage, histtype=\"step\",\n    )\n\nax.axvline(speed_threshold, linestyle=\"--\", color=\"red\", label=\"Speed threshold\")\n\nax.set_title(\"Body centroid speed\")\nax.set_xlabel(\"Speed (cm/sec)\")\nax.set_ylabel(\"Count\")\nax.set_yscale(\"log\")\nax.legend()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Body centroid speed histogram (log scale)](05-movement-mouse_files/figure-html/fig-speed-histogram-output-1.png){#fig-speed-histogram}\n:::\n:::\n\n\n::: {.callout-note}\nWe use the log scale because speeds tend to be exponentially distributed,\ni.e. the mouse spends far more time at low speeds than at high speeds.\nTry commenting out the `ax.set_yscale(\"log\")` line and see what happens.\n:::\n\nWe will generate separate occupancy heatmaps for when the mouse is stationary vs moving.\nWe can do this by [masking with `where()`](https://docs.xarray.dev/en/latest/user-guide/indexing.html#masking-with-where).\n\n::: {#8568b6be .cell execution_count=29}\n``` {.python .cell-code}\nstationary_mask = ds_kages[\"kage14\"].body_centroid_speed < 4\nstationary_mask\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;body_centroid_speed&#x27; (time: 4600675)&gt; Size: 5MB\nFalse False True True True True True True ... True True True True True True True\nCoordinates: (2)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'body_centroid_speed'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 4600675</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-2f915d02-b519-4eb5-913c-08abbf078c8a' class='xr-array-in' type='checkbox' ><label for='section-2f915d02-b519-4eb5-913c-08abbf078c8a' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>False False True True True True True ... True True True True True True</span></div><div class='xr-array-data'><pre>array([False, False,  True, ...,  True,  True,  True], shape=(4600675,))</pre></div></div></li><li class='xr-section-item'><input id='section-7db91bde-1e68-4a44-92c3-49be1cbf3af6' class='xr-section-summary-in' type='checkbox'  ><label for='section-7db91bde-1e68-4a44-92c3-49be1cbf3af6' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-09T00:00:06 ... 2024-05-...</div><input id='attrs-af5dfc1c-9f51-4d4e-bad2-4dbebc69c226' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-af5dfc1c-9f51-4d4e-bad2-4dbebc69c226' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3bc71cf6-f8f5-413e-ba15-fa72267daa01' class='xr-var-data-in' type='checkbox'><label for='data-3bc71cf6-f8f5-413e-ba15-fa72267daa01' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-09T00:00:06.000000000&#x27;, &#x27;2024-04-09T00:00:06.500000000&#x27;,\n       &#x27;2024-04-09T00:00:07.000000000&#x27;, ..., &#x27;2024-05-06T23:59:58.497744000&#x27;,\n       &#x27;2024-05-06T23:59:58.997674000&#x27;, &#x27;2024-05-06T23:59:59.497604000&#x27;],\n      shape=(4600675,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>seconds_elapsed</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.627e+04 3.627e+04 ... 2.455e+06</div><input id='attrs-70fdee05-7b05-4aa3-ba8c-1d9ca90d39bd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-70fdee05-7b05-4aa3-ba8c-1d9ca90d39bd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-64af90b1-0604-43e1-b1b3-f71b5fbcd6fd' class='xr-var-data-in' type='checkbox'><label for='data-64af90b1-0604-43e1-b1b3-f71b5fbcd6fd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  36266.      ,   36266.5     ,   36267.      , ..., 2455458.497744,\n       2455458.997674, 2455459.497604], shape=(4600675,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e62a33e0-1c1c-440c-88e9-08fa384ea19c' class='xr-section-summary-in' type='checkbox'  ><label for='section-e62a33e0-1c1c-440c-88e9-08fa384ea19c' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-46b40879-e573-4930-99de-4743423d207d' class='xr-index-data-in' type='checkbox'/><label for='index-46b40879-e573-4930-99de-4743423d207d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([       &#x27;2024-04-09 00:00:06&#x27;, &#x27;2024-04-09 00:00:06.500000&#x27;,\n                      &#x27;2024-04-09 00:00:07&#x27;, &#x27;2024-04-09 00:00:07.500000&#x27;,\n                      &#x27;2024-04-09 00:00:08&#x27;, &#x27;2024-04-09 00:00:08.500000&#x27;,\n                      &#x27;2024-04-09 00:00:09&#x27;, &#x27;2024-04-09 00:00:09.500000&#x27;,\n                      &#x27;2024-04-09 00:00:10&#x27;, &#x27;2024-04-09 00:00:10.500000&#x27;,\n               ...\n               &#x27;2024-05-06 23:59:54.998233&#x27;, &#x27;2024-05-06 23:59:55.498164&#x27;,\n               &#x27;2024-05-06 23:59:55.998094&#x27;, &#x27;2024-05-06 23:59:56.498024&#x27;,\n               &#x27;2024-05-06 23:59:56.997954&#x27;, &#x27;2024-05-06 23:59:57.497884&#x27;,\n               &#x27;2024-05-06 23:59:57.997814&#x27;, &#x27;2024-05-06 23:59:58.497744&#x27;,\n               &#x27;2024-05-06 23:59:58.997674&#x27;, &#x27;2024-05-06 23:59:59.497604&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=4600675, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-37070f6d-61bd-4186-b86f-e7f17eab76de' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-37070f6d-61bd-4186-b86f-e7f17eab76de' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nA \"mask\" is just a boolean array of the same shape as the original data.\nIt's `True` where the condition is met, and `False` otherwise.\n\n::: {#417865ef .cell execution_count=30}\n``` {.python .cell-code}\nstationary_position = ds_kages[\"kage14\"].body_centroid.where(stationary_mask)\nstationary_position\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;body_centroid&#x27; (time: 4600675, space: 2)&gt; Size: 74MB\nnan nan nan nan 198.7 177.6 198.7 ... 44.09 128.6 43.99 128.7 43.94 128.5 44.0\nCoordinates: (3)\nAttributes: (1)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'body_centroid'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 4600675</li><li><span class='xr-has-index'>space</span>: 2</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-ae095d67-2097-4ad9-a108-61c54de9a735' class='xr-array-in' type='checkbox' ><label for='section-ae095d67-2097-4ad9-a108-61c54de9a735' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>nan nan nan nan 198.7 177.6 ... 128.6 43.99 128.7 43.94 128.5 44.0</span></div><div class='xr-array-data'><pre>array([[         nan,          nan],\n       [         nan,          nan],\n       [198.68329239, 177.6133194 ],\n       ...,\n       [128.63087654,  43.9933548 ],\n       [128.66922379,  43.94464111],\n       [128.520895  ,  44.00013161]], shape=(4600675, 2))</pre></div></div></li><li class='xr-section-item'><input id='section-16accf91-010c-4552-ba6b-74a9b7ff0336' class='xr-section-summary-in' type='checkbox'  ><label for='section-16accf91-010c-4552-ba6b-74a9b7ff0336' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>space</span></div><div class='xr-var-dims'>(space)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;x&#x27; &#x27;y&#x27;</div><input id='attrs-a358b747-a611-485b-a269-b0fa19d17bce' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a358b747-a611-485b-a269-b0fa19d17bce' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-703ae708-0850-454d-9a42-2d935e01c41c' class='xr-var-data-in' type='checkbox'><label for='data-703ae708-0850-454d-9a42-2d935e01c41c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-09T00:00:06 ... 2024-05-...</div><input id='attrs-ea915f03-0a17-46f5-b5fa-b685efd919a0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ea915f03-0a17-46f5-b5fa-b685efd919a0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d4c68f94-02a6-44f8-b186-a280715a5cde' class='xr-var-data-in' type='checkbox'><label for='data-d4c68f94-02a6-44f8-b186-a280715a5cde' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-09T00:00:06.000000000&#x27;, &#x27;2024-04-09T00:00:06.500000000&#x27;,\n       &#x27;2024-04-09T00:00:07.000000000&#x27;, ..., &#x27;2024-05-06T23:59:58.497744000&#x27;,\n       &#x27;2024-05-06T23:59:58.997674000&#x27;, &#x27;2024-05-06T23:59:59.497604000&#x27;],\n      shape=(4600675,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>seconds_elapsed</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.627e+04 3.627e+04 ... 2.455e+06</div><input id='attrs-ce812e12-e9fa-4166-a2bf-a1e232635653' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ce812e12-e9fa-4166-a2bf-a1e232635653' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b7e7eea9-9ace-4c0d-8ced-d70dab97bb28' class='xr-var-data-in' type='checkbox'><label for='data-b7e7eea9-9ace-4c0d-8ced-d70dab97bb28' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  36266.      ,   36266.5     ,   36267.      , ...,\n       2455458.497744, 2455458.997674, 2455459.497604], shape=(4600675,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3765b4ef-ba9c-480a-8829-83bbed00cdeb' class='xr-section-summary-in' type='checkbox'  ><label for='section-3765b4ef-ba9c-480a-8829-83bbed00cdeb' class='xr-section-summary' >Indexes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>space</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-847654ea-6adb-48a5-8c20-297e59156119' class='xr-index-data-in' type='checkbox'/><label for='index-847654ea-6adb-48a5-8c20-297e59156119' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;object&#x27;, name=&#x27;space&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-cb595607-2ac8-48f9-afc2-cd071bb3c563' class='xr-index-data-in' type='checkbox'/><label for='index-cb595607-2ac8-48f9-afc2-cd071bb3c563' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([       &#x27;2024-04-09 00:00:06&#x27;, &#x27;2024-04-09 00:00:06.500000&#x27;,\n                      &#x27;2024-04-09 00:00:07&#x27;, &#x27;2024-04-09 00:00:07.500000&#x27;,\n                      &#x27;2024-04-09 00:00:08&#x27;, &#x27;2024-04-09 00:00:08.500000&#x27;,\n                      &#x27;2024-04-09 00:00:09&#x27;, &#x27;2024-04-09 00:00:09.500000&#x27;,\n                      &#x27;2024-04-09 00:00:10&#x27;, &#x27;2024-04-09 00:00:10.500000&#x27;,\n               ...\n               &#x27;2024-05-06 23:59:54.998233&#x27;, &#x27;2024-05-06 23:59:55.498164&#x27;,\n               &#x27;2024-05-06 23:59:55.998094&#x27;, &#x27;2024-05-06 23:59:56.498024&#x27;,\n               &#x27;2024-05-06 23:59:56.997954&#x27;, &#x27;2024-05-06 23:59:57.497884&#x27;,\n               &#x27;2024-05-06 23:59:57.997814&#x27;, &#x27;2024-05-06 23:59:58.497744&#x27;,\n               &#x27;2024-05-06 23:59:58.997674&#x27;, &#x27;2024-05-06 23:59:59.497604&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=4600675, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-450a5e1d-ffeb-497f-b177-23cb72903c41' class='xr-section-summary-in' type='checkbox'  ><label for='section-450a5e1d-ffeb-497f-b177-23cb72903c41' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>log :</span></dt><dd>[\n  {\n    &quot;operation&quot;: &quot;filter_by_confidence&quot;,\n    &quot;datetime&quot;: &quot;2025-08-18 17:57:18.141337&quot;,\n    &quot;confidence&quot;: &quot;&lt;xarray.DataArray &#x27;confidence&#x27; (time: 4600675, keypoints: 8, individuals: 1)&gt; Size: 294MB\\narray([[[         nan],\\n        [         nan],\\n        ...,\\n        [         nan],\\n        [         nan]],\\n\\n       [[1.728711e-02],\\n        [9.850310e-01],\\n        ...,\\n        [9.821828e-01],\\n        [8.725649e-04]],\\n\\n       ...,\\n\\n       [[9.718522e-01],\\n        [9.982640e-01],\\n        ...,\\n        [9.880463e-01],\\n        [9.681368e-01]],\\n\\n       [[9.761935e-01],\\n        [9.980691e-01],\\n        ...,\\n        [9.910011e-01],\\n        [9.745104e-01]]], shape=(4600675, 8, 1))\\nCoordinates: (4)&quot;,\n    &quot;threshold&quot;: &quot;0.95&quot;,\n    &quot;print_report&quot;: &quot;False&quot;\n  }\n]</dd></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nWe see that the `where()` method returns a new `xarray.DataArray` with the same dimensions as the original, but with the data values replaced by `NaN` where the condition (mask) is `False`.\n\nUsing this approach we can generate separate the body centroid position arrays\ninto states where the mouse is stationary vs moving, and then plot the occupancy\nheatmaps for each state.\n\n::: {#cell-fig-occupancy2 .cell execution_count=31}\n``` {.python .cell-code code-fold=\"true\"}\nfig, axes = plt.subplots(\n    nrows=2, ncols=2, figsize=(8, 8), sharex=True, sharey=True\n)\n\nplt.suptitle(\"Body centroid occupancy (log scale)\")\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    img = images[i]\n    height, width = img.shape[:2]\n\n    masks = {\n        \"stationary\": ds_kages[kage].body_centroid_speed < 4,\n        \"moving\": ds_kages[kage].body_centroid_speed >= 4,\n    }\n\n    for j, (mask_name, mask) in enumerate(masks.items()):\n        ax = axes[i, j]\n        ax.imshow(img)\n        plot_occupancy(\n            ds_kages[kage].body_centroid.where(mask).set_index(time=\"seconds_elapsed\"),\n            ax=ax,\n            cmap=\"turbo\",\n            norm=\"log\",\n            vmax=10**6,\n            alpha=0.6,\n        )\n        ax.set_title(f\"{kage} {mask_name}\")\n        ax.set_ylim([height - 1, 0])\n        ax.set_xlim([0, width])\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Occupancy heatmaps (stationary vs active)](05-movement-mouse_files/figure-html/fig-occupancy2-output-1.png){#fig-occupancy2}\n:::\n:::\n\n\nWe see some expected patterns like the nest being a \"hotspot\" during stationary periods,\nand going \"dark\" during active periods. But we also see some puzzling patterns:\nfor example, the running wheel is occupied during both periods, including when the mouse is \"stationary\".\n\nIs that because the mouse appears to be stationary to the camera as it's\nrunning \"in-place\" on the wheel (like on a treadmill)? Or maybe the mouse\nspends some of its downtime resting on the wheel?\n\n## Region of interest occupancy\n\nLet us precisely measure running wheel occupancy, i.e. the proportion of time\nthe mouse spends on the running wheel.\nHere we'll use `movement`'s [functionality for defining regions of interest (ROIs)](https://movement.neuroinformatics.dev/api/movement.roi.html).\n\nLet us create a circular \"running wheel\" ROI for each of the two kages.\n\n::: {#5a100a30 .cell execution_count=32}\n``` {.python .cell-code}\ncentres = {\n    \"kage14\": np.array([145, 260]),  # (x, y)\n    \"kage17\": np.array([385, 210]),\n}\nradius = 70\n\n# Create a unit circle\nn_points = 32\nangles = np.linspace(0, 2 * np.pi, n_points)\nunit_circle = np.column_stack([np.cos(angles), np.sin(angles)])\n\n# Create ROIs by scaling and shifting the unit circle\nrois = {}\nfor kage in [\"kage14\", \"kage17\"]:\n    points = centres[kage] + radius * unit_circle\n    roi = PolygonOfInterest(points, name=f\"{kage} running wheel\")\n    rois[kage] = roi\n```\n:::\n\n\n::: {.callout-note}\n\nAdmittedly, this is not the most precise or convenient way to define the running wheel ROI.\nIt would be better to directly draw shapes on the video frames.\n\nWe are actively working on a widget in `napari` that will enable this.\nStay tuned for updates in `movement` by joining the\n[\"movement\" channel on Zulip](https://neuroinformatics.zulipchat.com/#narrow/stream/406001-Movement).\n\n:::\n\nNow that we have the ROIs defined as `PolygonOfInterest` objects, we can use some of their\n[built-in methods](https://movement.neuroinformatics.dev/api/movement.roi.PolygonOfInterest.html).\n\nFor example, we can use `.plot()` to visualise the ROIs and verify that they are roughly in the right place.\n\n::: {#cell-fig-rois .cell execution_count=33}\n``` {.python .cell-code code-fold=\"true\"}\nfig, ax = plt.subplots(nrows=1, ncols=2, figsize=(8, 8))\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    img = images[i]\n    ax[i].imshow(img)\n    rois[kage].plot(ax=ax[i], alpha=0.25, facecolor=\"red\")\n    ax[i].legend()\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Running wheel ROIs](05-movement-mouse_files/figure-html/fig-rois-output-1.png){#fig-rois}\n:::\n:::\n\n\nWe can also use `.contains_point()` to check if a point is inside the ROI.\nIf we pass it a whole `xarray.DataArray` of points positions, e.g.\nthe positions of the mouse's body centroid over time, the check is performed\nfor each point in the array.\n\n::: {.callout-warning}\n\nThe following code cell will take a while to run, probably a few minutes.\nThat's because  we have a large amount of data\nand the `.contains_point()` method is not fully optimised yet.\n\nIf you are an experienced Python programmer this could be a cool\nproject for the hackday.\n\n:::\n\n::: {#443aa140 .cell execution_count=34}\n``` {.python .cell-code}\nroi_occupancy = {\n    kage: rois[kage].contains_point(ds_kages[kage].body_centroid)\n    for kage in [\"kage14\", \"kage17\"]\n}\n\nroi_occupancy[\"kage14\"]\n```\n\n::: {.cell-output .cell-output-display execution_count=33}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;body_centroid&#x27; (time: 4600675)&gt; Size: 5MB\nFalse False False False False False ... False False False False False False\nCoordinates: (2)\nAttributes: (1)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'body_centroid'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 4600675</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-ce634d23-5562-437c-b97d-3992e0acb861' class='xr-array-in' type='checkbox' ><label for='section-ce634d23-5562-437c-b97d-3992e0acb861' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>False False False False False False ... False False False False False</span></div><div class='xr-array-data'><pre>array([False, False, False, ..., False, False, False], shape=(4600675,))</pre></div></div></li><li class='xr-section-item'><input id='section-e1339b77-fd13-4ddf-ada3-22059126c18c' class='xr-section-summary-in' type='checkbox'  ><label for='section-e1339b77-fd13-4ddf-ada3-22059126c18c' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2024-04-09T00:00:06 ... 2024-05-...</div><input id='attrs-68983ba1-2b4b-4949-81ea-493c409d4e39' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-68983ba1-2b4b-4949-81ea-493c409d4e39' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8e834d82-3e74-4612-a296-27da6544b2b8' class='xr-var-data-in' type='checkbox'><label for='data-8e834d82-3e74-4612-a296-27da6544b2b8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2024-04-09T00:00:06.000000000&#x27;, &#x27;2024-04-09T00:00:06.500000000&#x27;,\n       &#x27;2024-04-09T00:00:07.000000000&#x27;, ..., &#x27;2024-05-06T23:59:58.497744000&#x27;,\n       &#x27;2024-05-06T23:59:58.997674000&#x27;, &#x27;2024-05-06T23:59:59.497604000&#x27;],\n      shape=(4600675,), dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>seconds_elapsed</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.627e+04 3.627e+04 ... 2.455e+06</div><input id='attrs-833cfb90-154d-45ff-84d0-0fea2d28b74f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-833cfb90-154d-45ff-84d0-0fea2d28b74f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3ba1ccd2-c369-4555-8d85-52e8245ca2be' class='xr-var-data-in' type='checkbox'><label for='data-3ba1ccd2-c369-4555-8d85-52e8245ca2be' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  36266.      ,   36266.5     ,   36267.      , ..., 2455458.497744,\n       2455458.997674, 2455459.497604], shape=(4600675,))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f3f3b0d1-a9df-4163-b3ff-6f32efa15851' class='xr-section-summary-in' type='checkbox'  ><label for='section-f3f3b0d1-a9df-4163-b3ff-6f32efa15851' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-04d0a223-92a6-473f-b519-de3099ef0026' class='xr-index-data-in' type='checkbox'/><label for='index-04d0a223-92a6-473f-b519-de3099ef0026' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([       &#x27;2024-04-09 00:00:06&#x27;, &#x27;2024-04-09 00:00:06.500000&#x27;,\n                      &#x27;2024-04-09 00:00:07&#x27;, &#x27;2024-04-09 00:00:07.500000&#x27;,\n                      &#x27;2024-04-09 00:00:08&#x27;, &#x27;2024-04-09 00:00:08.500000&#x27;,\n                      &#x27;2024-04-09 00:00:09&#x27;, &#x27;2024-04-09 00:00:09.500000&#x27;,\n                      &#x27;2024-04-09 00:00:10&#x27;, &#x27;2024-04-09 00:00:10.500000&#x27;,\n               ...\n               &#x27;2024-05-06 23:59:54.998233&#x27;, &#x27;2024-05-06 23:59:55.498164&#x27;,\n               &#x27;2024-05-06 23:59:55.998094&#x27;, &#x27;2024-05-06 23:59:56.498024&#x27;,\n               &#x27;2024-05-06 23:59:56.997954&#x27;, &#x27;2024-05-06 23:59:57.497884&#x27;,\n               &#x27;2024-05-06 23:59:57.997814&#x27;, &#x27;2024-05-06 23:59:58.497744&#x27;,\n               &#x27;2024-05-06 23:59:58.997674&#x27;, &#x27;2024-05-06 23:59:59.497604&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, length=4600675, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5c594fef-7238-4deb-ba5a-19f809c743e9' class='xr-section-summary-in' type='checkbox'  ><label for='section-5c594fef-7238-4deb-ba5a-19f809c743e9' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>log :</span></dt><dd>[\n  {\n    &quot;operation&quot;: &quot;filter_by_confidence&quot;,\n    &quot;datetime&quot;: &quot;2025-08-18 17:57:18.141337&quot;,\n    &quot;confidence&quot;: &quot;&lt;xarray.DataArray &#x27;confidence&#x27; (time: 4600675, keypoints: 8, individuals: 1)&gt; Size: 294MB\\narray([[[         nan],\\n        [         nan],\\n        ...,\\n        [         nan],\\n        [         nan]],\\n\\n       [[1.728711e-02],\\n        [9.850310e-01],\\n        ...,\\n        [9.821828e-01],\\n        [8.725649e-04]],\\n\\n       ...,\\n\\n       [[9.718522e-01],\\n        [9.982640e-01],\\n        ...,\\n        [9.880463e-01],\\n        [9.681368e-01]],\\n\\n       [[9.761935e-01],\\n        [9.980691e-01],\\n        ...,\\n        [9.910011e-01],\\n        [9.745104e-01]]], shape=(4600675, 8, 1))\\nCoordinates: (4)&quot;,\n    &quot;threshold&quot;: &quot;0.95&quot;,\n    &quot;print_report&quot;: &quot;False&quot;\n  }\n]</dd></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nThe ROI occupancy data is a boolean array which is `True` when a point\n(in this case the mouse's body centroid at each time point)\nis inside the ROI, and `False` otherwise.\n\n::: {#cell-fig-roi-occupancy-line .cell execution_count=35}\n``` {.python .cell-code code-fold=\"true\"}\nfig, axes = plt.subplots(\n    nrows=2, ncols=1, figsize=(7.5, 5), sharex=True, sharey=True\n)\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    ax = axes[i]\n    roi_occupancy[kage].sel(time=slice(None, \"2024-04-09 23:59:59\")).plot.line(\n        \"-\", ax=ax, lw=0.1\n    )\n    ax.set_title(kage)\n    ax.set_ylabel(\"Occupancy\")\n    ax.set_yticks([0, 1])\n    ax.set_yticklabels([\"False\", \"True\"])\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Running wheel occupancy during April 9, 2024](05-movement-mouse_files/figure-html/fig-roi-occupancy-line-output-1.png){#fig-roi-occupancy-line}\n:::\n:::\n\n\nWe can also compute the % of time the mouse spends on the running wheel.\n\n::: {#ecf0605e .cell execution_count=36}\n``` {.python .cell-code}\nfor kage in [\"kage14\", \"kage17\"]:\n    # Count the ratio of True values in the array\n    on_wheel_ratio = roi_occupancy[kage].mean(dim=\"time\").values\n    # Convert to percentage\n    pct_on_wheel = float(100 * on_wheel_ratio)\n    print(f\"{kage} spends {pct_on_wheel:.1f}% of its time on the running wheel\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nkage14 spends 7.7% of its time on the running wheel\nkage17 spends 5.6% of its time on the running wheel\n```\n:::\n:::\n\n\nBut how does the running wheel occupancy relate to the light cycle?\nWe can segment the ROI occupancy data into dark and light periods for each day\nand compute the % of time spent on the running wheel during each period.\n\n::: {#6e1a7d2b .cell execution_count=37}\n``` {.python .cell-code code-fold=\"true\"}\ndays = list(\n    roi_occupancy[\"kage14\"].dropna(dim=\"time\").groupby(\"time.date\").groups.keys()\n)\nn_days = len(days)\n\n# Create a new DataArray of NaNs with shape (kage, date, period)\ndaily_occupancy = xr.DataArray(\n    np.full((2, n_days, 2), np.nan),\n    dims=[\"kage\", \"date\", \"period\"],\n    coords={\n        \"kage\": [\"kage14\", \"kage17\"],\n        \"date\": days,\n        \"period\": [\"dark\", \"light\"]\n    },\n)\n\nfor kage in [\"kage14\", \"kage17\"]:\n    for date, day_ds in roi_occupancy[kage].dropna(dim=\"time\").groupby(\"time.date\"):\n        dark_period = slice(f\"{date} 09:30:00\", f\"{date} 21:30:00\")\n        light_period1 = slice(f\"{date} 00:00:00\", f\"{date} 09:30:00\")\n        light_period2 = slice(f\"{date} 21:30:00\", f\"{date} 23:59:59\")\n\n        dark_occupancy = 100 * day_ds.sel(time=dark_period).mean()\n        light_occupancy = 100 * (\n            day_ds.sel(time=light_period1).mean() +\n            day_ds.sel(time=light_period2).mean()\n        )\n\n        daily_occupancy.loc[dict(kage=kage, date=date, period=\"dark\")] = dark_occupancy\n        daily_occupancy.loc[dict(kage=kage, date=date, period=\"light\")] = light_occupancy\n```\n:::\n\n\n::: {#350e61f6 .cell execution_count=38}\n``` {.python .cell-code}\ndaily_occupancy\n```\n\n::: {.cell-output .cell-output-display execution_count=37}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (kage: 2, date: 27, period: 2)&gt; Size: 864B\n18.14 0.5802 14.61 0.2946 15.77 0.05681 ... 7.642 1.184 6.061 1.822 5.416 1.465\nCoordinates: (3)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>kage</span>: 2</li><li><span class='xr-has-index'>date</span>: 27</li><li><span class='xr-has-index'>period</span>: 2</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-4f745062-8a92-4e3a-bd6d-8871b0b95a76' class='xr-array-in' type='checkbox' ><label for='section-4f745062-8a92-4e3a-bd6d-8871b0b95a76' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>18.14 0.5802 14.61 0.2946 15.77 ... 1.184 6.061 1.822 5.416 1.465</span></div><div class='xr-array-data'><pre>array([[[18.13721182,  0.58020834],\n        [14.61429664,  0.29461052],\n        [15.77476872,  0.05681437],\n        [17.50275346,  0.09224193],\n        [16.79477815,  0.16400123],\n        [21.09387679,  0.34003517],\n        [22.30209155,  0.05797538],\n        [25.09129694,  0.09135919],\n        [19.21257652,  0.44861916],\n        [20.14724638,  0.42807444],\n        [10.57427028,  0.35374141],\n        [20.48226293,  0.41311089],\n        [17.57491451,  0.37366155],\n        [23.04687047,  0.22957797],\n        [24.79366625,  0.52732957],\n        [22.83723788,  0.83547609],\n        [13.37413962,  0.47727011],\n        [10.37548834,  1.68838776],\n        [ 7.56987353,  0.        ],\n        [10.09540149,  2.25066261],\n...\n        [ 4.60557584,  0.72872661],\n        [ 2.87145126,  0.7931199 ],\n        [        nan,         nan],\n        [14.65730083,  0.09372208],\n        [12.79994436,  1.024094  ],\n        [11.59018712,  1.25811336],\n        [12.3581439 ,  0.88033789],\n        [17.19648488,  1.35126619],\n        [15.02411091,  4.8502329 ],\n        [14.7872957 ,  0.8731539 ],\n        [ 6.47423636,  2.6038989 ],\n        [ 8.67453399, 16.23910604],\n        [10.69304865,  0.7644518 ],\n        [ 9.61627637,  0.48341291],\n        [13.3663309 ,  2.00887393],\n        [ 9.25234728,  3.90692875],\n        [14.20903758,  0.9260435 ],\n        [ 7.64156958,  1.18385996],\n        [ 6.06127346,  1.82213469],\n        [ 5.41580692,  1.4653501 ]]])</pre></div></div></li><li class='xr-section-item'><input id='section-85545948-7247-42d3-92ee-53a53c9d4d60' class='xr-section-summary-in' type='checkbox'  ><label for='section-85545948-7247-42d3-92ee-53a53c9d4d60' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>kage</span></div><div class='xr-var-dims'>(kage)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;kage14&#x27; &#x27;kage17&#x27;</div><input id='attrs-86398fb0-4614-473d-b541-13e8e96fe3a1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-86398fb0-4614-473d-b541-13e8e96fe3a1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dbb35cf0-6ed4-4459-9ff1-3b313da29ca0' class='xr-var-data-in' type='checkbox'><label for='data-dbb35cf0-6ed4-4459-9ff1-3b313da29ca0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;kage14&#x27;, &#x27;kage17&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>date</span></div><div class='xr-var-dims'>(date)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>2024-04-09 ... 2024-05-06</div><input id='attrs-c70030c1-7060-4f22-8a99-4be386c12250' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c70030c1-7060-4f22-8a99-4be386c12250' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d31880f9-54cb-4193-aba7-cff5381ecc6b' class='xr-var-data-in' type='checkbox'><label for='data-d31880f9-54cb-4193-aba7-cff5381ecc6b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([datetime.date(2024, 4, 9), datetime.date(2024, 4, 10),\n       datetime.date(2024, 4, 11), datetime.date(2024, 4, 13),\n       datetime.date(2024, 4, 14), datetime.date(2024, 4, 15),\n       datetime.date(2024, 4, 16), datetime.date(2024, 4, 17),\n       datetime.date(2024, 4, 18), datetime.date(2024, 4, 19),\n       datetime.date(2024, 4, 20), datetime.date(2024, 4, 21),\n       datetime.date(2024, 4, 22), datetime.date(2024, 4, 23),\n       datetime.date(2024, 4, 24), datetime.date(2024, 4, 25),\n       datetime.date(2024, 4, 26), datetime.date(2024, 4, 27),\n       datetime.date(2024, 4, 28), datetime.date(2024, 4, 29),\n       datetime.date(2024, 4, 30), datetime.date(2024, 5, 1),\n       datetime.date(2024, 5, 2), datetime.date(2024, 5, 3),\n       datetime.date(2024, 5, 4), datetime.date(2024, 5, 5),\n       datetime.date(2024, 5, 6)], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>period</span></div><div class='xr-var-dims'>(period)</div><div class='xr-var-dtype'>&lt;U5</div><div class='xr-var-preview xr-preview'>&#x27;dark&#x27; &#x27;light&#x27;</div><input id='attrs-8b96c0d6-cae2-4811-a8c8-5e154b113d1a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8b96c0d6-cae2-4811-a8c8-5e154b113d1a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-03a8f3e2-eac3-4407-899d-e8354699c8fe' class='xr-var-data-in' type='checkbox'><label for='data-03a8f3e2-eac3-4407-899d-e8354699c8fe' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;dark&#x27;, &#x27;light&#x27;], dtype=&#x27;&lt;U5&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-aeaa99ae-a600-4d62-b60d-221fd6d18fa6' class='xr-section-summary-in' type='checkbox'  ><label for='section-aeaa99ae-a600-4d62-b60d-221fd6d18fa6' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>kage</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-eb22365a-9aae-4e66-b182-79bfe4e22b85' class='xr-index-data-in' type='checkbox'/><label for='index-eb22365a-9aae-4e66-b182-79bfe4e22b85' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;kage14&#x27;, &#x27;kage17&#x27;], dtype=&#x27;object&#x27;, name=&#x27;kage&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>date</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-fcbf3543-0684-4c81-9816-750673326453' class='xr-index-data-in' type='checkbox'/><label for='index-fcbf3543-0684-4c81-9816-750673326453' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([2024-04-09, 2024-04-10, 2024-04-11, 2024-04-13, 2024-04-14, 2024-04-15,\n       2024-04-16, 2024-04-17, 2024-04-18, 2024-04-19, 2024-04-20, 2024-04-21,\n       2024-04-22, 2024-04-23, 2024-04-24, 2024-04-25, 2024-04-26, 2024-04-27,\n       2024-04-28, 2024-04-29, 2024-04-30, 2024-05-01, 2024-05-02, 2024-05-03,\n       2024-05-04, 2024-05-05, 2024-05-06],\n      dtype=&#x27;object&#x27;, name=&#x27;date&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>period</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-09c194d9-a2f3-44fc-b588-e22a74638939' class='xr-index-data-in' type='checkbox'/><label for='index-09c194d9-a2f3-44fc-b588-e22a74638939' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;dark&#x27;, &#x27;light&#x27;], dtype=&#x27;object&#x27;, name=&#x27;period&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-50844f89-27df-4614-867c-350af9c6d094' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-50844f89-27df-4614-867c-350af9c6d094' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nLet's visualise the % of time spent on the running wheel during the light and dark periods of each day.\n\n::: {#cell-fig-roi-occupancy .cell execution_count=39}\n``` {.python .cell-code code-fold=\"true\"}\nfig, axes = plt.subplots(nrows=1, ncols=2, figsize=(8, 4), sharex=True, sharey=True)\n\nmax_occupancy = daily_occupancy.max()\n\nfor i, kage in enumerate([\"kage14\", \"kage17\"]):\n    daily_occupancy.sel(kage=kage).plot(\n        ax=axes[i], lw=3, vmax=daily_occupancy.max(), yincrease=False\n    )\n\n    axes[i].set_title(f\"{kage} running wheel occupancy\")\n    axes[i].set_xticks([0.25, 0.75])\n    axes[i].set_ylabel(\"Occupancy (%)\")\n    axes[i].set_xlabel(\"Period\")\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Running wheel occupancy during light and dark periods](05-movement-mouse_files/figure-html/fig-roi-occupancy-output-1.png){#fig-roi-occupancy}\n:::\n:::\n\n\nAs we would expect, both mice tend to spend more time on the running wheel\nduring the dark (active) periods.\n\nEven though the mouse in `kage17` is more active overall, as we saw\nin @sec-actograms, it spends less time on the running wheel\ncompared to the mouse in `kage14`.\n\n",
    "supporting": [
      "05-movement-mouse_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}