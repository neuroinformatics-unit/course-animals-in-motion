{
  "hash": "bf2967892c6a33ad87785f2b12f50990",
  "result": {
    "engine": "jupyter",
    "markdown": "# Zebra escape trajectories {#sec-movement-zebras}\n\nIn this case study we will be using [`movement`](https://movement.neuroinformatics.dev/) to quantify the collective behaviour of a herd of zebras in escape response. The data we will use is part of a larger dataset collected in Mpala (Kenya), in which researchers simulated a predation event to study the group response of the animals. We will demonstrate how we can compute useful metrics for this analysis using `movement`.\n\n::: {.callout-note title=\"Using the right environment\"}\n\nIf you are following along this chapter on your own computer,\nmake sure to run all code snippets with the `animals-in-motion-env` environment activated\n(see [prerequisites @sec-install-movement]).\n\n:::\n\n## Dataset description\n\n<!-- Some information about the dataset, with credits to Isla, and citing the preprint.\nAnalysis will roughly follow <https://github.com/neuroinformatics-unit/zebras-stitching/blob/main/notebooks/03_notebook_compute_behaviour_metrics.py>. -->\n\nThe 3.5-min dataset presented here consists of 44 trajectories of zebras (_Equus quagga_) expressed in a coordinate system fixed to the ground. Each individual has two keypoints (`head` and `tail`). The data was obtained as follows: first, a trained [`SLEAP`](https://sleap.ai/) model was run on a video clip recorded from a camera drone, to obtain the trajectories of the zebras in a coordinate system linked to the drone. Then, the trajectories were expressed in a coordinate system fixed to the ground using [Structure-from-motion](https://en.wikipedia.org/wiki/Structure_from_motion) (with [`OpenSFM`](https://github.com/mapillary/OpenSfM) and [`OpenDroneMap`](https://github.com/OpenDroneMap/OpenDroneMap)). This transformation between camera and world coordinate systems is necessary to be able to disentangle the motion of the zebras from the movement of the camera drone. After this coordinate transformation, the data was cleaned by removing low-confidence keypoints and implausible data points.\n\nYou can find a detailed description of the approach as a collection of notebooks in [this repository](https://github.com/neuroinformatics-unit/zebras-stitching). Further details about the dataset and the prototype pipeline can be found in Duporge, Miñano _et al_ [-@duporge_tracking_2025].\n\n::: {.callout-note title=\"Acknowledgement\"}\nThe sample video and original SLEAP trajectories were kindly shared by [Dr. Isla Duporge](https://eeb.princeton.edu/people/isla-duporge) from the [Rubenstein Lab at Princeton University](https://dir.princeton.edu/), with permission to use for this workshop. The trajectories in world coordinate system were computed by Sofía Miñano, Niko Sirmpilatze and Igor Tatarnikov.\n:::\n\n## Load and explore the dataset\n\nFirst, let's load and explore the dataset\n\n::: {#23239f48 .cell execution_count=2}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n\nimport numpy as np\nimport xarray as xr\n\nfrom movement import sample_data\nfrom movement.kinematics import compute_pairwise_distances, compute_speed\nfrom movement.transforms import scale\nfrom movement.utils.vector import compute_norm, convert_to_unit\nfrom movement.utils.reports import report_nan_values\n```\n:::\n\n\n::: {#4a2c33ea .cell execution_count=3}\n``` {.python .cell-code}\nds = sample_data.fetch_dataset(\"SLEAP_OSFM_zebras_drone.h5\")\nds\n```\n\n::: {.cell-output .cell-output-display execution_count=249}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 7MB\nDimensions:      (time: 6294, space: 2, keypoints: 2, individuals: 44)\nCoordinates:\n  * time         (time) float64 50kB 0.0 0.03337 0.06673 ... 209.9 209.9 210.0\n  * space        (space) &lt;U1 8B &#x27;x&#x27; &#x27;y&#x27;\n  * keypoints    (keypoints) &lt;U1 8B &#x27;H&#x27; &#x27;T&#x27;\n  * individuals  (individuals) &lt;U8 1kB &#x27;track_0&#x27; &#x27;track_1&#x27; ... &#x27;track_43&#x27;\nData variables:\n    position     (time, space, keypoints, individuals) float32 4MB 1.035e+03 ...\n    confidence   (time, keypoints, individuals) float32 2MB 0.9987 ... 1.006\nAttributes:\n    source_software:  SLEAP\n    ds_type:          poses\n    fps:              29.97\n    time_unit:        seconds\n    source_file:      /Users/nsirmpilatze/.movement/data/poses/SLEAP_OSFM_zeb...</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-f0dacc79-b005-42af-87fb-fa033b9176a0' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f0dacc79-b005-42af-87fb-fa033b9176a0' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 6294</li><li><span class='xr-has-index'>space</span>: 2</li><li><span class='xr-has-index'>keypoints</span>: 2</li><li><span class='xr-has-index'>individuals</span>: 44</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-4ef23077-27da-4240-9d46-013f511aca4d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-4ef23077-27da-4240-9d46-013f511aca4d' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.03337 0.06673 ... 209.9 210.0</div><input id='attrs-2292a60d-6e94-4916-afc1-80220eccf718' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2292a60d-6e94-4916-afc1-80220eccf718' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e8f17223-2ce8-4c85-9a94-6a8a5d9c725b' class='xr-var-data-in' type='checkbox'><label for='data-e8f17223-2ce8-4c85-9a94-6a8a5d9c725b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.000000e+00, 3.336670e-02, 6.673340e-02, ..., 2.099099e+02,\n       2.099433e+02, 2.099766e+02], shape=(6294,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>space</span></div><div class='xr-var-dims'>(space)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;x&#x27; &#x27;y&#x27;</div><input id='attrs-05f85a45-889b-4843-af46-e3ca1613ac38' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-05f85a45-889b-4843-af46-e3ca1613ac38' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a87889ca-a897-4793-8e1a-7eb46b1bb9e9' class='xr-var-data-in' type='checkbox'><label for='data-a87889ca-a897-4793-8e1a-7eb46b1bb9e9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>keypoints</span></div><div class='xr-var-dims'>(keypoints)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;H&#x27; &#x27;T&#x27;</div><input id='attrs-54cdb4e8-01ed-440b-8d16-45a93ccb4173' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-54cdb4e8-01ed-440b-8d16-45a93ccb4173' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bd28fe4c-0bd9-4871-86ee-01eaa85d9473' class='xr-var-data-in' type='checkbox'><label for='data-bd28fe4c-0bd9-4871-86ee-01eaa85d9473' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;H&#x27;, &#x27;T&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>individuals</span></div><div class='xr-var-dims'>(individuals)</div><div class='xr-var-dtype'>&lt;U8</div><div class='xr-var-preview xr-preview'>&#x27;track_0&#x27; &#x27;track_1&#x27; ... &#x27;track_43&#x27;</div><input id='attrs-be007070-e956-4703-907f-7f45053ee050' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-be007070-e956-4703-907f-7f45053ee050' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ae538785-e334-4987-ba99-e37a7046f965' class='xr-var-data-in' type='checkbox'><label for='data-ae538785-e334-4987-ba99-e37a7046f965' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;track_0&#x27;, &#x27;track_1&#x27;, &#x27;track_10&#x27;, &#x27;track_11&#x27;, &#x27;track_12&#x27;, &#x27;track_13&#x27;,\n       &#x27;track_14&#x27;, &#x27;track_15&#x27;, &#x27;track_16&#x27;, &#x27;track_17&#x27;, &#x27;track_18&#x27;, &#x27;track_19&#x27;,\n       &#x27;track_2&#x27;, &#x27;track_20&#x27;, &#x27;track_21&#x27;, &#x27;track_22&#x27;, &#x27;track_23&#x27;, &#x27;track_24&#x27;,\n       &#x27;track_25&#x27;, &#x27;track_26&#x27;, &#x27;track_27&#x27;, &#x27;track_28&#x27;, &#x27;track_29&#x27;, &#x27;track_3&#x27;,\n       &#x27;track_30&#x27;, &#x27;track_31&#x27;, &#x27;track_32&#x27;, &#x27;track_33&#x27;, &#x27;track_34&#x27;, &#x27;track_35&#x27;,\n       &#x27;track_36&#x27;, &#x27;track_37&#x27;, &#x27;track_38&#x27;, &#x27;track_39&#x27;, &#x27;track_4&#x27;, &#x27;track_40&#x27;,\n       &#x27;track_41&#x27;, &#x27;track_42&#x27;, &#x27;track_5&#x27;, &#x27;track_6&#x27;, &#x27;track_7&#x27;, &#x27;track_8&#x27;,\n       &#x27;track_9&#x27;, &#x27;track_43&#x27;], dtype=&#x27;&lt;U8&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-64f463a6-a8cb-412e-bd47-6a724e4e9610' class='xr-section-summary-in' type='checkbox'  checked><label for='section-64f463a6-a8cb-412e-bd47-6a724e4e9610' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>position</span></div><div class='xr-var-dims'>(time, space, keypoints, individuals)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1.035e+03 1.043e+03 ... 680.6 743.0</div><input id='attrs-cabfd21b-ada2-43ea-9493-d7eadaff53c3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cabfd21b-ada2-43ea-9493-d7eadaff53c3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e6addcd9-6718-4c16-b254-a423b598de96' class='xr-var-data-in' type='checkbox'><label for='data-e6addcd9-6718-4c16-b254-a423b598de96' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[1035.0875 , 1042.7065 , 1305.2988 , ..., 1288.8965 ,\n          1075.2968 ,        nan],\n         [1055.7279 , 1056.1145 , 1287.899  , ..., 1272.5366 ,\n          1061.8053 ,        nan]],\n\n        [[1170.7526 , 1198.7987 , 1207.2275 , ..., 1196.4867 ,\n          1274.6531 ,        nan],\n         [1175.2821 , 1195.3256 , 1216.0687 , ..., 1210.1553 ,\n          1258.3647 ,        nan]]],\n\n\n       [[[1036.3914 , 1047.7836 , 1306.7142 , ..., 1290.4705 ,\n          1076.7327 ,        nan],\n         [1056.8123 , 1057.0919 , 1289.186  , ..., 1274.0607 ,\n          1062.8341 ,        nan]],\n\n        [[1170.8033 , 1197.9618 , 1207.1444 , ..., 1196.7869 ,\n          1274.542  ,        nan],\n         [1175.3003 , 1195.433  , 1216.0906 , ..., 1210.2795 ,\n          1258.3342 ,        nan]]],\n...\n          5037.79   , 4924.202  ],\n         [       nan, 4916.7803 ,        nan, ..., 5216.492  ,\n          5016.4253 , 4944.2705 ]],\n\n        [[       nan,  731.70557,        nan, ...,  994.94434,\n           689.243  ,  738.3227 ],\n         [       nan,  731.16486,        nan, ...,  975.09174,\n           680.5491 ,  743.00867]]],\n\n\n       [[[       nan, 4897.603  ,        nan, ..., 5213.083  ,\n          5037.834  , 4924.2344 ],\n         [       nan, 4916.813  ,        nan, ..., 5216.505  ,\n          5016.4824 , 4944.314  ]],\n\n        [[       nan,  731.7324 ,        nan, ...,  994.9447 ,\n           689.2539 ,  738.3456 ],\n         [       nan,  731.19904,        nan, ...,  975.0833 ,\n           680.563  ,  743.02875]]]],\n      shape=(6294, 2, 2, 44), dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>confidence</span></div><div class='xr-var-dims'>(time, keypoints, individuals)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.9987 0.9696 ... 0.9946 1.006</div><input id='attrs-f3497a73-db87-44ce-8c76-18bb6082a7cb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f3497a73-db87-44ce-8c76-18bb6082a7cb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5864c4e0-010d-4b55-8a8b-346717ac6d4a' class='xr-var-data-in' type='checkbox'><label for='data-5864c4e0-010d-4b55-8a8b-346717ac6d4a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[0.9986721 , 0.96957946, 0.97588646, ..., 0.9835917 ,\n         0.99211425,        nan],\n        [1.006721  , 1.0021206 , 0.99066794, ..., 0.99203897,\n         1.0121652 ,        nan]],\n\n       [[0.9872179 , 0.97352976, 0.97786933, ..., 0.98417157,\n         0.99206424,        nan],\n        [1.0023106 , 1.0009985 , 0.9916664 , ..., 0.9919399 ,\n         0.9985494 ,        nan]],\n\n       [[1.002729  , 1.0058758 , 0.9846221 , ..., 0.9828853 ,\n         0.9683708 ,        nan],\n        [1.0021431 , 0.9725971 , 0.9884142 , ..., 0.99417496,\n         0.9847228 ,        nan]],\n\n       ...,\n\n       [[       nan, 0.99612695,        nan, ..., 0.98065114,\n         0.98576516, 0.99649894],\n        [       nan, 0.99007297,        nan, ..., 0.99566007,\n         0.9955021 , 1.0055838 ]],\n\n       [[       nan, 0.9971069 ,        nan, ..., 0.98106676,\n         0.98654073, 0.9961379 ],\n        [       nan, 0.9902725 ,        nan, ..., 0.9969691 ,\n         0.9945675 , 1.0057868 ]],\n\n       [[       nan, 0.9971091 ,        nan, ..., 0.9822346 ,\n         0.9864464 , 0.99721533],\n        [       nan, 0.9900413 ,        nan, ..., 0.9947883 ,\n         0.9946445 , 1.0055223 ]]], shape=(6294, 2, 44), dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0ae82757-ea03-4b9b-95e1-801109603e2a' class='xr-section-summary-in' type='checkbox'  ><label for='section-0ae82757-ea03-4b9b-95e1-801109603e2a' class='xr-section-summary' >Indexes: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-9a43a690-15bc-4120-90be-9c6878e63299' class='xr-index-data-in' type='checkbox'/><label for='index-9a43a690-15bc-4120-90be-9c6878e63299' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([                 0.0, 0.033366700033366704,  0.06673340006673341,\n         0.1001001001001001,  0.13346680013346682,  0.16683350016683351,\n         0.2002002002002002,   0.2335669002335669,  0.26693360026693363,\n         0.3003003003003003,\n       ...\n         209.67634300967634,   209.70970970970973,   209.74307640974308,\n         209.77644310977644,   209.80980980980982,   209.84317650984318,\n         209.87654320987656,    209.9099099099099,    209.9432766099433,\n         209.97664330997665],\n      dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=6294))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>space</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-6dcffee9-40b6-4a41-bd85-af1f64140e21' class='xr-index-data-in' type='checkbox'/><label for='index-6dcffee9-40b6-4a41-bd85-af1f64140e21' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;object&#x27;, name=&#x27;space&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>keypoints</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-4659abcb-b1ef-487c-8352-4e61cccf6b47' class='xr-index-data-in' type='checkbox'/><label for='index-4659abcb-b1ef-487c-8352-4e61cccf6b47' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;H&#x27;, &#x27;T&#x27;], dtype=&#x27;object&#x27;, name=&#x27;keypoints&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>individuals</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-c4bac03f-529c-407b-9546-43aa2b3e1331' class='xr-index-data-in' type='checkbox'/><label for='index-c4bac03f-529c-407b-9546-43aa2b3e1331' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;track_0&#x27;, &#x27;track_1&#x27;, &#x27;track_10&#x27;, &#x27;track_11&#x27;, &#x27;track_12&#x27;, &#x27;track_13&#x27;,\n       &#x27;track_14&#x27;, &#x27;track_15&#x27;, &#x27;track_16&#x27;, &#x27;track_17&#x27;, &#x27;track_18&#x27;, &#x27;track_19&#x27;,\n       &#x27;track_2&#x27;, &#x27;track_20&#x27;, &#x27;track_21&#x27;, &#x27;track_22&#x27;, &#x27;track_23&#x27;, &#x27;track_24&#x27;,\n       &#x27;track_25&#x27;, &#x27;track_26&#x27;, &#x27;track_27&#x27;, &#x27;track_28&#x27;, &#x27;track_29&#x27;, &#x27;track_3&#x27;,\n       &#x27;track_30&#x27;, &#x27;track_31&#x27;, &#x27;track_32&#x27;, &#x27;track_33&#x27;, &#x27;track_34&#x27;, &#x27;track_35&#x27;,\n       &#x27;track_36&#x27;, &#x27;track_37&#x27;, &#x27;track_38&#x27;, &#x27;track_39&#x27;, &#x27;track_4&#x27;, &#x27;track_40&#x27;,\n       &#x27;track_41&#x27;, &#x27;track_42&#x27;, &#x27;track_5&#x27;, &#x27;track_6&#x27;, &#x27;track_7&#x27;, &#x27;track_8&#x27;,\n       &#x27;track_9&#x27;, &#x27;track_43&#x27;],\n      dtype=&#x27;object&#x27;, name=&#x27;individuals&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-234aa502-f376-40a7-81a4-7d5be5f06e0a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-234aa502-f376-40a7-81a4-7d5be5f06e0a' class='xr-section-summary' >Attributes: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>source_software :</span></dt><dd>SLEAP</dd><dt><span>ds_type :</span></dt><dd>poses</dd><dt><span>fps :</span></dt><dd>29.97</dd><dt><span>time_unit :</span></dt><dd>seconds</dd><dt><span>source_file :</span></dt><dd>/Users/nsirmpilatze/.movement/data/poses/SLEAP_OSFM_zebras_drone.h5</dd></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nWe can see the [poses dataset](https://movement.neuroinformatics.dev/user_guide/movement_dataset.html#dataset-structure) `ds` is made up of two data arrays, `position` and `confidence`. In this example, we will use the `position` data array only, which spans four dimensions: `time`, `space`, `keypoints` and `individuals`. We can verify there are 44 individuals in this dataset (`track_0` to `track_43`) and two keypoints per individual, labelled `H` (head) and `T` (tailbase). The data was collected at 29.97 frames per second, and the dataloader used this information to automatically express the `time` dimension in seconds.\n\n::: {.callout-note title=\"Position units\"}\nThe `position` data in `ds` is expressed in arbitrary units. This is because no GPS data was available for georeferencing or defining ground control points in the structure-from-motion (SfM) analysis. As a result, the scale factor remains a free parameter in the reconstruction of the world coordinates.\n\nNote however that this will not be a problem for our analysis, since the relative positions between the individuals are still correct. Moreover, we will use the median zebra body length to scale the data to more informative units. For more details on the coordinate systems involved in SfM analysis see the [OpenSfM documentation](https://opensfm.org/docs/geometry.html#world-coordinates).\n:::\n\n## Compute the body length per individual\n\nWe define the body vector for each individual as the vector going from the `T` keypoint (tail) to the `H` keypoint (head).\n\n::: {#c7d5921c .cell execution_count=4}\n``` {.python .cell-code}\nbody_vector = ds.position.sel(keypoints=\"H\") - ds.position.sel(keypoints=\"T\")\n\nbody_vector\n```\n\n::: {.cell-output .cell-output-display execution_count=250}\n```{=html}\n<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base rgba(0, 0, 0, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(0, 0, 0, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, white)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, white) h s calc(l - 15))\n  );\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: var(\n    --jp-content-font-color0,\n    var(--pst-color-text-base, rgba(255, 255, 255, 1))\n  );\n  --xr-font-color2: var(\n    --jp-content-font-color2,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.54))\n  );\n  --xr-font-color3: var(\n    --jp-content-font-color3,\n    var(--pst-color-text-base, rgba(255, 255, 255, 0.38))\n  );\n  --xr-border-color: var(\n    --jp-border-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 10))\n  );\n  --xr-disabled-color: var(\n    --jp-layout-color3,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 40))\n  );\n  --xr-background-color: var(\n    --jp-layout-color0,\n    var(--pst-color-on-background, #111111)\n  );\n  --xr-background-color-row-even: var(\n    --jp-layout-color1,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 5))\n  );\n  --xr-background-color-row-odd: var(\n    --jp-layout-color2,\n    hsl(from var(--pst-color-on-background, #111111) h s calc(l + 15))\n  );\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n  border: 2px solid transparent !important;\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0) !important;\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  border-color: var(--xr-background-color-row-odd);\n  margin-bottom: 0;\n  padding-top: 2px;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n  border-color: var(--xr-background-color-row-even);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  border-top: 2px dotted var(--xr-background-color);\n  padding-bottom: 20px !important;\n  padding-top: 10px !important;\n}\n\n.xr-var-attrs-in + label,\n.xr-var-data-in + label,\n.xr-index-data-in + label {\n  padding: 0 1px;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-data > pre,\n.xr-index-data > pre,\n.xr-var-data > table > tbody > tr {\n  background-color: transparent !important;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n\n.xr-var-attrs-in:checked + label > .xr-icon-file-text2,\n.xr-var-data-in:checked + label > .xr-icon-database,\n.xr-index-data-in:checked + label > .xr-icon-database {\n  color: var(--xr-font-color0);\n  filter: drop-shadow(1px 1px 5px var(--xr-font-color2));\n  stroke-width: 0.8px;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;position&#x27; (time: 6294, space: 2, individuals: 44)&gt; Size: 2MB\n-20.64 -13.41 17.4 8.969 21.4 -4.405 ... -0.1141 3.393 4.625 19.86 8.691 -4.683\nCoordinates:\n  * time         (time) float64 50kB 0.0 0.03337 0.06673 ... 209.9 209.9 210.0\n  * space        (space) &lt;U1 8B &#x27;x&#x27; &#x27;y&#x27;\n  * individuals  (individuals) &lt;U8 1kB &#x27;track_0&#x27; &#x27;track_1&#x27; ... &#x27;track_43&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'position'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 6294</li><li><span class='xr-has-index'>space</span>: 2</li><li><span class='xr-has-index'>individuals</span>: 44</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-f876304a-c7f6-4160-984b-a7ec6339135a' class='xr-array-in' type='checkbox' ><label for='section-f876304a-c7f6-4160-984b-a7ec6339135a' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>-20.64 -13.41 17.4 8.969 21.4 ... 3.393 4.625 19.86 8.691 -4.683</span></div><div class='xr-array-data'><pre>array([[[-20.64038   , -13.407959  ,  17.39978   , ...,  16.359863  ,\n          13.491455  ,          nan],\n        [ -4.529541  ,   3.4731445 ,  -8.841187  , ..., -13.668579  ,\n          16.28833   ,          nan]],\n\n       [[-20.420898  ,  -9.30835   ,  17.528198  , ...,  16.40979   ,\n          13.89856   ,          nan],\n        [ -4.4969482 ,   2.5288086 ,  -8.946167  , ..., -13.492676  ,\n          16.207764  ,          nan]],\n\n       [[-20.80188   , -17.699585  ,  17.320312  , ...,  16.389404  ,\n          14.212769  ,          nan],\n        [ -4.6690674 ,   4.485962  ,  -8.845093  , ..., -13.594238  ,\n          15.8845215 ,          nan]],\n\n       ...,\n\n       [[         nan, -19.214844  ,          nan, ...,  -3.4248047 ,\n          21.367676  , -20.073242  ],\n        [         nan,   0.55041504,          nan, ...,  19.87909   ,\n           8.734253  ,  -4.6884766 ]],\n\n       [[         nan, -19.21045   ,          nan, ...,  -3.4033203 ,\n          21.364746  , -20.06836   ],\n        [         nan,   0.54071045,          nan, ...,  19.8526    ,\n           8.693909  ,  -4.685974  ]],\n\n       [[         nan, -19.20996   ,          nan, ...,  -3.421875  ,\n          21.351562  , -20.07959   ],\n        [         nan,   0.53338623,          nan, ...,  19.86139   ,\n           8.690918  ,  -4.6831665 ]]], shape=(6294, 2, 44), dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-beb38d6a-f3a8-4cdb-9c9f-2c5c4d8077fa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-beb38d6a-f3a8-4cdb-9c9f-2c5c4d8077fa' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.03337 0.06673 ... 209.9 210.0</div><input id='attrs-def030c2-de3c-4fe3-be10-97fe49fdff8a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-def030c2-de3c-4fe3-be10-97fe49fdff8a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fab69d6e-d2c8-4546-9883-fa42bc5a6e8f' class='xr-var-data-in' type='checkbox'><label for='data-fab69d6e-d2c8-4546-9883-fa42bc5a6e8f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.000000e+00, 3.336670e-02, 6.673340e-02, ..., 2.099099e+02,\n       2.099433e+02, 2.099766e+02], shape=(6294,))</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>space</span></div><div class='xr-var-dims'>(space)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;x&#x27; &#x27;y&#x27;</div><input id='attrs-6008ce41-1726-49cf-97b5-50c0f0ac7ec9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6008ce41-1726-49cf-97b5-50c0f0ac7ec9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-714e5ae0-81c5-4429-861b-be20b92f43fb' class='xr-var-data-in' type='checkbox'><label for='data-714e5ae0-81c5-4429-861b-be20b92f43fb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>individuals</span></div><div class='xr-var-dims'>(individuals)</div><div class='xr-var-dtype'>&lt;U8</div><div class='xr-var-preview xr-preview'>&#x27;track_0&#x27; &#x27;track_1&#x27; ... &#x27;track_43&#x27;</div><input id='attrs-c3b9d807-62e9-4994-b96c-1c2a7b361a7b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c3b9d807-62e9-4994-b96c-1c2a7b361a7b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d4787e73-80a0-4d06-b824-287310e2b424' class='xr-var-data-in' type='checkbox'><label for='data-d4787e73-80a0-4d06-b824-287310e2b424' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;track_0&#x27;, &#x27;track_1&#x27;, &#x27;track_10&#x27;, &#x27;track_11&#x27;, &#x27;track_12&#x27;, &#x27;track_13&#x27;,\n       &#x27;track_14&#x27;, &#x27;track_15&#x27;, &#x27;track_16&#x27;, &#x27;track_17&#x27;, &#x27;track_18&#x27;, &#x27;track_19&#x27;,\n       &#x27;track_2&#x27;, &#x27;track_20&#x27;, &#x27;track_21&#x27;, &#x27;track_22&#x27;, &#x27;track_23&#x27;, &#x27;track_24&#x27;,\n       &#x27;track_25&#x27;, &#x27;track_26&#x27;, &#x27;track_27&#x27;, &#x27;track_28&#x27;, &#x27;track_29&#x27;, &#x27;track_3&#x27;,\n       &#x27;track_30&#x27;, &#x27;track_31&#x27;, &#x27;track_32&#x27;, &#x27;track_33&#x27;, &#x27;track_34&#x27;, &#x27;track_35&#x27;,\n       &#x27;track_36&#x27;, &#x27;track_37&#x27;, &#x27;track_38&#x27;, &#x27;track_39&#x27;, &#x27;track_4&#x27;, &#x27;track_40&#x27;,\n       &#x27;track_41&#x27;, &#x27;track_42&#x27;, &#x27;track_5&#x27;, &#x27;track_6&#x27;, &#x27;track_7&#x27;, &#x27;track_8&#x27;,\n       &#x27;track_9&#x27;, &#x27;track_43&#x27;], dtype=&#x27;&lt;U8&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c2391bcb-da97-44c7-bbbe-fb75680492a6' class='xr-section-summary-in' type='checkbox'  ><label for='section-c2391bcb-da97-44c7-bbbe-fb75680492a6' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-196680ba-6307-46fe-b445-c068890cca79' class='xr-index-data-in' type='checkbox'/><label for='index-196680ba-6307-46fe-b445-c068890cca79' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([                 0.0, 0.033366700033366704,  0.06673340006673341,\n         0.1001001001001001,  0.13346680013346682,  0.16683350016683351,\n         0.2002002002002002,   0.2335669002335669,  0.26693360026693363,\n         0.3003003003003003,\n       ...\n         209.67634300967634,   209.70970970970973,   209.74307640974308,\n         209.77644310977644,   209.80980980980982,   209.84317650984318,\n         209.87654320987656,    209.9099099099099,    209.9432766099433,\n         209.97664330997665],\n      dtype=&#x27;float64&#x27;, name=&#x27;time&#x27;, length=6294))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>space</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-8a54bc51-8bde-4338-b1a8-f5529b4e4b21' class='xr-index-data-in' type='checkbox'/><label for='index-8a54bc51-8bde-4338-b1a8-f5529b4e4b21' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;x&#x27;, &#x27;y&#x27;], dtype=&#x27;object&#x27;, name=&#x27;space&#x27;))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>individuals</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-76a2e275-5a25-463a-b669-ee30cd9911cb' class='xr-index-data-in' type='checkbox'/><label for='index-76a2e275-5a25-463a-b669-ee30cd9911cb' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([&#x27;track_0&#x27;, &#x27;track_1&#x27;, &#x27;track_10&#x27;, &#x27;track_11&#x27;, &#x27;track_12&#x27;, &#x27;track_13&#x27;,\n       &#x27;track_14&#x27;, &#x27;track_15&#x27;, &#x27;track_16&#x27;, &#x27;track_17&#x27;, &#x27;track_18&#x27;, &#x27;track_19&#x27;,\n       &#x27;track_2&#x27;, &#x27;track_20&#x27;, &#x27;track_21&#x27;, &#x27;track_22&#x27;, &#x27;track_23&#x27;, &#x27;track_24&#x27;,\n       &#x27;track_25&#x27;, &#x27;track_26&#x27;, &#x27;track_27&#x27;, &#x27;track_28&#x27;, &#x27;track_29&#x27;, &#x27;track_3&#x27;,\n       &#x27;track_30&#x27;, &#x27;track_31&#x27;, &#x27;track_32&#x27;, &#x27;track_33&#x27;, &#x27;track_34&#x27;, &#x27;track_35&#x27;,\n       &#x27;track_36&#x27;, &#x27;track_37&#x27;, &#x27;track_38&#x27;, &#x27;track_39&#x27;, &#x27;track_4&#x27;, &#x27;track_40&#x27;,\n       &#x27;track_41&#x27;, &#x27;track_42&#x27;, &#x27;track_5&#x27;, &#x27;track_6&#x27;, &#x27;track_7&#x27;, &#x27;track_8&#x27;,\n       &#x27;track_9&#x27;, &#x27;track_43&#x27;],\n      dtype=&#x27;object&#x27;, name=&#x27;individuals&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-039c504f-0b23-41cc-ae82-d8651ed2abd8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-039c504f-0b23-41cc-ae82-d8651ed2abd8' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>\n```\n:::\n:::\n\n\nWe can compute the body length of each individual by computing the norm of the body vector.\n\n::: {#10a81256 .cell execution_count=5}\n``` {.python .cell-code}\n# Compute body length per individual\nbody_length = compute_norm(body_vector)\n```\n:::\n\n\nIt would be useful to check if there are missing values in the body length array. We can quickly inspect this using `movement`'s `report_nan_values` function.\n\n::: {#fe50d274 .cell execution_count=6}\n``` {.python .cell-code}\nprint(report_nan_values(body_length))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nMissing points (marked as NaN) in position:\n\nindividuals\ntrack_0       234/6294 (3.72%)\ntrack_1       286/6294 (4.54%)\ntrack_10      614/6294 (9.76%)\ntrack_11      369/6294 (5.86%)\ntrack_12      519/6294 (8.25%)\ntrack_13      420/6294 (6.67%)\ntrack_14      353/6294 (5.61%)\ntrack_15       434/6294 (6.9%)\ntrack_16     827/6294 (13.14%)\ntrack_17      241/6294 (3.83%)\ntrack_18      483/6294 (7.67%)\ntrack_19      196/6294 (3.11%)\ntrack_2      645/6294 (10.25%)\ntrack_20      557/6294 (8.85%)\ntrack_21      576/6294 (9.15%)\ntrack_22        88/6294 (1.4%)\ntrack_23     633/6294 (10.06%)\ntrack_24       85/6294 (1.35%)\ntrack_25       43/6294 (0.68%)\ntrack_26     813/6294 (12.92%)\ntrack_27       315/6294 (5.0%)\ntrack_28    1208/6294 (19.19%)\ntrack_29      127/6294 (2.02%)\ntrack_3       224/6294 (3.56%)\ntrack_30      235/6294 (3.73%)\ntrack_31       91/6294 (1.45%)\ntrack_32        25/6294 (0.4%)\ntrack_33      362/6294 (5.75%)\ntrack_34       447/6294 (7.1%)\ntrack_35     742/6294 (11.79%)\ntrack_36     741/6294 (11.77%)\ntrack_37     766/6294 (12.17%)\ntrack_38      415/6294 (6.59%)\ntrack_39    1254/6294 (19.92%)\ntrack_4        17/6294 (0.27%)\ntrack_40      523/6294 (8.31%)\ntrack_41      263/6294 (4.18%)\ntrack_42      236/6294 (3.75%)\ntrack_5        93/6294 (1.48%)\ntrack_6      718/6294 (11.41%)\ntrack_7       432/6294 (6.86%)\ntrack_8      731/6294 (11.61%)\ntrack_9       388/6294 (6.16%)\ntrack_43      548/6294 (8.71%)\n```\n:::\n:::\n\n\nThe output shows that the number of missing values per individual varies between 0.27% and 19.92%. This is not necessarily a problem for our analysis, but it is something to keep in mind when interpreting the results. These missing points are likely due to imperfect tracking of one or both of the keypoints required to compute the body vector.\n\nLet's compute some basic statistics to get a sense of the distribution of the body length values.\n\n::: {#7be6c554 .cell execution_count=7}\n``` {.python .cell-code}\n# Compute basic statistics\nbody_length_std = body_length.std()\nbody_length_mean = body_length.mean()\nbody_length_median = body_length.median()\n\nprint(f\"Body length mean: {body_length_mean:.2f} a.u.\")  # a.u.: arbitrary units\nprint(f\"Body length median: {body_length_median:.2f} a.u.\")\nprint(f\"Body length std: {body_length_std:.2f} a.u.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBody length mean: 20.45 a.u.\nBody length median: 20.43 a.u.\nBody length std: 2.32 a.u.\n```\n:::\n:::\n\n\nWe can also plot the distribution of body lengths.\n\n::: {#cell-fig-body-length-distribution .cell execution_count=8}\n``` {.python .cell-code code-fold=\"true\"}\nfig, ax = plt.subplots()\n\n# plot histogram of body length values\ncounts, bins, _ = body_length.plot.hist(bins=100)\n\n# add reference lines for mean and mean +- 2 stds\nax.vlines(\n    body_length_mean,\n    ymin=0,\n    ymax=np.max(counts),\n    color=\"red\",\n    linestyle=\"-\",\n    label=\"mean body length\",\n)\nlower_bound = body_length_mean - 2 * body_length_std\nupper_bound = body_length_mean + 2 * body_length_std\nfor bound in [lower_bound, upper_bound]:\n    ax.vlines(\n        bound,\n        ymin=0,\n        ymax=np.max(counts),\n        color=\"red\",\n        linestyle=\"--\",\n        label=\"mean +- 2 std\",\n    )\nax.set_ylim(0, np.max(counts))\nax.set_xlabel(\"body length (a.u.)\")\nax.set_ylabel(\"counts\")\nax.legend()\n```\n\n::: {.cell-output .cell-output-display}\n![Distribution of zebra body lengths.](06-movement-zebras_files/figure-html/fig-body-length-distribution-output-1.png){#fig-body-length-distribution}\n:::\n:::\n\n\nWe can see there is some variability in the body lengths per individual. Part of it may reflect the diversity across individuals, but from visual inspection of the video we expect the majority of it to be due to imperfect tracking of the keypoints. To remove some of these outliers, we continue the analysis considering only body vectors that are within 2 standard deviations of the mean.\n\n::: {#ede8fb91 .cell execution_count=9}\n``` {.python .cell-code}\nbody_vector_filtered = body_vector.where(\n    np.logical_and(\n        body_length <= body_length_mean + 2 * body_length_std,\n        body_length >= body_length_mean - 2 * body_length_std,\n    )\n)\n```\n:::\n\n\n## Compute polarization\n\nWe would now like to inspect the orientation of each individual in relation to the group while the simulated escape events take place.\n\nFor this, we first compute each animal's **unit body vector**. These are a scaled version of the body vectors we just computed, normalised to have unit length. `movement` provides a convenience function to do this:\n\n::: {#2b1ca5d4 .cell execution_count=10}\n``` {.python .cell-code}\nbody_vector_filtered_unit = convert_to_unit(body_vector_filtered)\n```\n:::\n\n\nWe can quickly check if their norms are now equal to 1.\n\n::: {#99b1385b .cell execution_count=11}\n``` {.python .cell-code}\nprint(compute_norm(body_vector_filtered_unit)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<xarray.DataArray 'position' (time: 6294, individuals: 44)> Size: 1MB\n1.0 nan 1.0 1.0 1.0 1.0 1.0 1.0 1.0 nan ... 1.0 1.0 nan 1.0 1.0 1.0 1.0 1.0 1.0\nCoordinates:\n  * time         (time) float64 50kB 0.0 0.03337 0.06673 ... 209.9 209.9 210.0\n  * individuals  (individuals) <U8 1kB 'track_0' 'track_1' ... 'track_43'\n```\n:::\n:::\n\n\nWe now define the **herd vector** as the mean of the unit body vectors across all individuals. The mean vector of a set of $n$ vectors is the sum of all the vectors (i.e., the resultant vector) scaled by $1/n$.\n\n::: {#675d250f .cell execution_count=12}\n``` {.python .cell-code}\nherd_vector = body_vector_filtered_unit.mean(\"individuals\")\nprint(herd_vector) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<xarray.DataArray 'position' (time: 6294, space: 2)> Size: 50kB\n0.5835 -0.4923 0.5589 -0.4968 0.5252 ... 0.4129 0.3367 0.4131 0.3156 0.4332\nCoordinates:\n  * time     (time) float64 50kB 0.0 0.03337 0.06673 ... 209.9 209.9 210.0\n  * space    (space) <U1 8B 'x' 'y'\n```\n:::\n:::\n\n\nThe resulting array has `(time, space)` dimensions, which means that we have a single herd vector defined at each timestep.\n\nThe norm of the herd vector already gives us an intuition of how aligned the whole herd is. When its norm is close to 1, it means that the majority of the unit body vectors are aligned. When its norm is close to 0, it means that the unit body vectors are dispersed. The norm of the herd vector is sometimes called **polarization**.\n\n::: {#37b83457 .cell execution_count=13}\n``` {.python .cell-code}\npolarization = compute_norm(herd_vector)\n```\n:::\n\n\nWe can plot the evolution of the polarization over time to get a sense of how the herd's alignment changes.\n\n::: {#cell-fig-polarization .cell execution_count=14}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.plot(herd_vector.time, polarization)\nax.set_ylabel(\"polarization\")\nax.set_xlabel(\"time (s)\")\nax.grid()\n```\n\n::: {.cell-output .cell-output-display}\n![Evolution of the herd's polarization over time.](06-movement-zebras_files/figure-html/fig-polarization-output-1.png){#fig-polarization}\n:::\n:::\n\n\nThe plot suggests that the herd alternates between periods of higher and lower polarization.\n\n## Compute average speed of the herd\n\nWe would also like to inspect how the speed of the herd changes over the course of the simulated escape events.\n\nFirst, let's scale the position data to express it in units of body lengths (BL). This will make the results more interpretable. We can use `movement`'s `scale` function to do this.\n\n::: {#60e073e8 .cell execution_count=15}\n``` {.python .cell-code}\nposition_scaled = scale(\n    ds.position, \n    factor=1 / body_length_median.item(), \n    space_unit=\"body_length\",\n)\n```\n:::\n\n\nFor simplicity, we would also like to reduce the position of each individual to a single point. A good candidate for this is the centroid, which is the mean of all the keypoints per individual. In our case, the centroid will be the midpoint between the head and tail keypoints.\n\n::: {#bc604c0a .cell execution_count=16}\n``` {.python .cell-code}\ncentroid = position_scaled.mean(\"keypoints\")\n```\n:::\n\n\n::: {.callout-tip title=\"Exercise A\"}\n\nUse the `centroid` data array to:\n\n1. Compute `centroid_speed`, the speed of each individual's centroid.\n2. Compute `herd_speed`, the average speed across all individuals.\n3. Plot the evolution of `herd_speed` over time.\n:::\n\n::: {.content-visible when-profile=\"answers\"}\n::: {.callout-tip title=\"Click to reveal the answers\" collapse=\"true\"}\n\n::: {#2c6241b8 .cell execution_count=17}\n``` {.python .cell-code}\n# Compute speed of each zebra's centroid\ncentroid_speed = compute_speed(centroid)\n\n# Compute the average speed across all individuals\nherd_speed = centroid_speed.mean(\"individuals\")\n\n# Plot the evolution of the herd speed over time\nfig, ax = plt.subplots()\nax.plot(herd_speed.time, herd_speed)\nax.set_ylabel(\"herd speed (BL/s)\")\nax.set_xlabel(\"time (s)\")\nax.grid()\n```\n\n::: {.cell-output .cell-output-display}\n![](06-movement-zebras_files/figure-html/cell-17-output-1.png){}\n:::\n:::\n\n\nWe can see that there are four periods in the dataset in which the speed of the herd surpasses 2 BL/s for about 10 to 20 seconds.\n\n:::\n:::\n\nWe can also inspect how the speed of each individual changes over time.\n\n::: {#cell-fig-speed-individuals-time .cell execution_count=18}\n``` {.python .cell-code code-fold=\"true\"}\nfig, ax = plt.subplots()\nim = ax.matshow(\n    centroid_speed,\n    aspect=\"auto\",\n    cmap=\"viridis\",\n)\n\n# convert frames to seconds in y-axis\ntime_ticks_step = 1498\ntime_ticks = np.arange(0, len(centroid_speed.time), time_ticks_step) \ntime_labels = [f\"{t:.0f}\" for t in centroid_speed.time.values[0:-1:time_ticks_step]]\nax.set_yticks(time_ticks)\nax.set_yticklabels(time_labels)\nax.tick_params(axis='x', bottom=True, top=False, labelbottom=True, labeltop=False)\n\nax.set_xlabel(\"individual\")\nax.set_ylabel(\"time (s)\") \n\n# add colorbar\ncbar = plt.colorbar(im)\ncbar.set_label(\"speed (BL/s)\")\nax.get_images()[0].set_clim(0, 6) # cap values at 6 BL/s\n```\n\n::: {.cell-output .cell-output-display}\n![Evolution of the speed of each individual over time.](06-movement-zebras_files/figure-html/fig-speed-individuals-time-output-1.png){#fig-speed-individuals-time}\n:::\n:::\n\n\nThe plot suggests that the individuals are quite coordinated also in their change of speed. We can clearly see the four periods of higher speed, which correspond to the four simulated escape events.\n\n## Polarization vs speed\n\nLet's put it all together and inspect how polarization changes with the speed of the herd.\n\nWe will use the logarithm of the speed to focus on the higher range of speeds.\n\n::: {#5b083f1a .cell execution_count=19}\n``` {.python .cell-code}\nlog10_herd_speed = np.log10(herd_speed)\n```\n:::\n\n\nWe can now plot the polarization in time, colouring the points by the logarithm of the speed.\n\n::: {#cell-fig-polarization-vs-speed .cell execution_count=20}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nsc = ax.scatter(\n    x=polarization.time,\n    y=polarization,\n    c=log10_herd_speed,\n    s=5,\n    cmap=\"turbo\",\n    # rescale color map to 1st and 99th percentiles\n    vmin=log10_herd_speed.quantile(0.01).item(),\n    vmax=log10_herd_speed.quantile(0.99).item(),\n)\n\n\nax.set_xlabel(\"time (s)\")\nax.set_ylabel(\"polarization\")\n\ncbar = plt.colorbar(sc)\ncbar.set_label(\"log10 herd speed (BL/s)\")\n```\n\n::: {.cell-output .cell-output-display}\n![Periods of highest polarization are associated with higher speeds](06-movement-zebras_files/figure-html/fig-polarization-vs-speed-output-1.png){#fig-polarization-vs-speed}\n:::\n:::\n\n\nThe plot shows that for this dataset, the periods of highest polarization are associated with higher speeds. This is consistent with the interpretation that the zebras become more aligned when escaping at speed, and more dispersed when they are at rest.\n\n",
    "supporting": [
      "06-movement-zebras_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}